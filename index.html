<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¤©è³¦èƒ½é‡æ¸¬é©—ï½œæ­£å¼ç‰ˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box}

    html{
      height:100%;
      background:url("https://i.ibb.co/FbVWf5RN/2025-12-19-20-46-29.png") center/cover no-repeat fixed;
    }

    body{
      margin:0;
      min-height:100%;
      font-family:"Noto Sans TC",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:transparent;
      color:#111827;
      position:relative;
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:rgba(255,255,255,.65);
      pointer-events:none;
      z-index:-1;
    }

    .section{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      text-align:center;
      position:relative;
      z-index:1;
    }
    button{cursor:pointer}

    /* é–‹å§‹é  */
    #startPage h1{
      color:#c0822a;
      font-size:clamp(28px,5vw,40px);
      margin-bottom:12px;
    }
    #startPage p{
      font-size:16px;
      margin-bottom:20px;
      color:#374151;
      line-height:1.7;
    }

    /* é–‹å§‹ä½œç­”æŒ‰éˆ• */
    #startPage button{
      padding:14px 28px;
      font-size:18px;
      font-weight:700;
      border:none;
      border-radius:14px;
      background:#8A571A;
      color:#fff;
      box-shadow:0 8px 24px rgba(138,87,26,.35);
    }
    #startPage button:hover{filter:brightness(1.05)}

    /* é¡Œç›®é  */
    #quizPage{display:none;text-align:left;}
    #quizInner{
      max-width:720px;
      width:100%;
      margin:0 auto;
      padding:20px 18px;
      border-radius:22px;
      position:relative;
      overflow:hidden;

      background:linear-gradient(
        180deg,
        rgba(255,255,255,.60) 0%,
        rgba(255,255,255,.30) 55%,
        rgba(108,74,242,.10) 100%
      );

      backdrop-filter: blur(14px) saturate(1.3);
      -webkit-backdrop-filter: blur(14px) saturate(1.3);

      border:1.5px solid rgba(255,255,255,.65);

      box-shadow:
        0 20px 56px rgba(17,24,39,.14),
        inset 0 0 0 1px rgba(255,255,255,.45);
    }

    #progress{font-size:14px;color:#6b7280;margin-bottom:8px;}
    #questionTitle{font-size:20px;font-weight:800;margin-bottom:14px;line-height:1.6;color:#111827;}

    .option{
      padding:12px 10px;
      border-radius:12px;
      border:1px solid rgba(17,24,39,.18);
      font-size:16px;
      margin-top:10px;
      background:transparent;
      color:#111827;
      transition:.18s;
      user-select:none;
      backdrop-filter:none;
    }

    .option:hover{
      border-color:#A56A2A;
      color:#7A4A1E;
      box-shadow:0 10px 24px rgba(165,106,42,.18);
      transform:translateY(-1px);
      background:rgba(165,106,42,.08);
    }

    .option.selected{
      border-color:#A56A2A;
      color:#7A4A1E;
      background:rgba(165,106,42,.14);
      box-shadow:0 14px 30px rgba(165,106,42,.22);
      transform:translateY(-1px);
    }

    #navRow{
      margin-top:18px;
      display:flex;
      justify-content:space-between;
      gap:8px;
    }
    #navRow button{
      flex:1;
      padding:10px 0;
      border-radius:10px;
      border:none;
      font-size:15px;
      font-weight:700;
    }
    #prevBtn{background:#f3f4f6;color:#111827;}
    #prevBtn:disabled{opacity:.4;cursor:not-allowed;}

    :root{
      --camel:#B07A3A;
      --camelText:#ffffff;
      --camelShadow: rgba(176,122,58,.30);
    }
    #nextBtn{
      background:var(--camel);
      color:var(--camelText);
      box-shadow:0 6px 18px var(--camelShadow);
    }

    /* çµæœé  */
    #resultPage{display:none;text-align:left;}
    #resultInner{
      max-width:980px;
      width:100%;
      margin:0 auto;
      padding:22px 18px 20px;
      border-radius:22px;
      position:relative;
      overflow:hidden;

      background:linear-gradient(
        180deg,
        rgba(255,255,255,.58) 0%,
        rgba(255,255,255,.28) 55%,
        rgba(108,74,242,.08) 100%
      );

      backdrop-filter: blur(14px) saturate(1.3);
      -webkit-backdrop-filter: blur(14px) saturate(1.3);

      border:1.5px solid rgba(255,255,255,.62);

      box-shadow:
        0 22px 60px rgba(17,24,39,.16),
        inset 0 0 0 1px rgba(255,255,255,.42);

      display:flex;
      flex-direction:column;
      gap:14px;
    }

    /* âœ… æ–‡å­—å€åŠ æ¡†æ¡† */
    #textBox{
      border-radius:18px;
      padding:16px 14px;
      background:rgba(255,255,255,.72);
      border:1px solid rgba(17,24,39,.10);
      box-shadow:0 10px 26px rgba(17,24,39,.06);
      text-align:left;
    }

    #energyLine{
      display:flex;
      flex-direction:column;
      gap:8px;
      color:#111827;
    }
    #energyLine .label{
      font-weight:900;
      font-size:18px;
      letter-spacing:.2px;
    }
    /* âœ… ç™¼é›»æ©Ÿ/ç¯€å¥é‚£è¡Œä¸è¦ç²—é«” */
    #energyLine .energyVals{
      display:flex;
      flex-wrap:wrap;
      gap:10px 14px;
      align-items:center;
      font-size:15px;
      font-weight:500;
      color:#111827;
    }

    #summaryLine{
      white-space:pre-wrap;
      font-size:15px;
      line-height:1.7;
      color:#374151;
      margin-top:6px;
      font-weight:700;
    }

    #finalTraitTitle{
      font-size:22px;
      font-weight:900;
      color:#111827;
      margin:10px 0 0;
      line-height:1.35;
    }
    #traitOneLine{
      font-size:15px;
      color:#374151;
      margin:6px 0 10px;
      font-weight:500;
      line-height:1.75;
      white-space:pre-wrap;
    }

    #traitCard{
      border:none;
      border-radius:0;
      padding:0;
      background:transparent;
    }

    .kTitle{
      color:#7A1F1F;
      font-weight:800;
      margin:10px 0 6px;
      font-size:14px;
      letter-spacing:.5px;
    }

    .kBody{
      white-space:pre-wrap;
      font-size:15px;
      line-height:1.85;
      color:#111827;
      margin:0;
      font-weight:400;
    }

    /* âœ… åœ–ç‰‡å€æ°¸é ä¸Šä¸‹ï¼ˆé›·é”åœ¨ä¸Šã€åœ–ç‰‡åœ¨ä¸‹ï¼‰ */
    #vizRow{
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      margin-top:2px;
    }

    #radar{
      width:100%;
      max-width:520px;
      aspect-ratio:1/1;
      height:auto;
      display:block;
      margin:0 auto;
    }

    #traitImgs{
      width:100%;
      max-width:520px;
      margin:0 auto;
      display:grid;
      gap:10px;
      justify-items:center;
      align-items:center;
    }
    #traitImgs.one img{ width:min(520px, 100%); }

    #traitImgs.one{grid-template-columns:1fr;}
    #traitImgs.two{grid-template-columns:1fr 1fr;}
    @media(max-width:520px){
      #traitImgs.two{grid-template-columns:1fr;}
    }

    #traitImgs img{
      width:100%;
      border-radius:18px;
      display:block;
      object-fit:cover;
      max-height:320px;
    }

    /* âœ… åº•éƒ¨æŒ‰éˆ•ç½®ä¸­ + æ–°å¢ä¸‹è¼‰æŒ‰éˆ• */
    #btnRow{
      margin-top:6px;
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .pillBtn{
      padding:11px 18px;
      border:none;
      border-radius:999px;
      font-weight:900;
      font-size:15px;
      cursor:pointer;
      box-shadow:0 10px 24px var(--camelShadow);
      min-width:150px;
    }
    #againBtn{
      background:var(--camel);
      color:var(--camelText);
    }
    #downloadBtn{
      background:#111827;
      color:#fff;
      box-shadow:0 10px 24px rgba(17,24,39,.25);
    }
    #downloadBtn[disabled]{opacity:.65;cursor:not-allowed;}

    /* âœ… ä¸‹è¼‰ç”¨ IG åˆ†äº«å¡å¤–æ¡†ç•™ç™½ï¼ˆåªåœ¨ä¸‹è¼‰æ™‚ç”¨ï¼Œå¹³å¸¸è—èµ·ä¾†ï¼‰ */
    #shareStage{
      position:fixed;
      left:-99999px;
      top:-99999px;
      width:1080px;
      padding:64px;
      background:#f6f7fb;
    }
    #shareCard{
      background:#fff;
      border-radius:42px;
      padding:34px;
      border:1px solid rgba(17,24,39,.08);
      box-shadow:0 30px 70px rgba(17,24,39,.12);
    }
    #shareCard #traitImgs img{ max-height:360px; }

    #shareFooter{
      margin-top:14px;
      font-size:14px;
      color:#6b7280;
      text-align:center;
      font-weight:600;
    }
  </style>
</head>

<body>

  <section id="startPage" class="section">
    <div>
      <h1>å®Œæˆ 25 é¡Œ<br>æ¸¬å‡ºä½ çš„å¤©è³¦èƒ½é‡</h1>
      <p>ç”¨ 8 å¤§è·æ¶¯ç‰¹è³ªï¼Œçœ‹è¦‹æœ€é©åˆä½ çš„è³ºéŒ¢æ–¹å¼<br>5 åˆ†é˜ï¼Œå°±èƒ½æŠŠä½ çš„å¤©è³¦åœ°åœ–æ‰“é–‹ã€‚</p>
      <button id="startBtn">é–‹å§‹ä½œç­”</button>
    </div>
  </section>

  <section id="quizPage" class="section">
    <div id="quizInner">
      <div id="progress"></div>
      <div id="questionTitle"></div>
      <div id="options"></div>
      <div id="navRow">
        <button id="prevBtn">â¬… ä¸Šä¸€é¡Œ</button>
        <button id="nextBtn">ä¸‹ä¸€é¡Œ âœ</button>
      </div>
    </div>
  </section>

  <section id="resultPage" class="section">
    <div id="resultInner">

      <div id="textBox">
        <div id="energyLine"></div>
        <div id="summaryLine"></div>

        <div id="traitCard">
          <div id="finalTraitTitle"></div>
          <div id="traitOneLine"></div>

          <div class="kTitle">ã€ä½ å¾ˆå¼·çš„åœ°æ–¹ã€‘</div>
          <p class="kBody" id="advText"></p>

          <div class="kTitle">ã€å®¹æ˜“å¡ä½çš„åœ°æ–¹ã€‘</div>
          <p class="kBody" id="blindText"></p>

          <div class="kTitle">ã€é †æµç­–ç•¥ã€‘</div>
          <p class="kBody" id="wealthText"></p>
        </div>
      </div>

      <div id="vizRow">
        <canvas id="radar"></canvas>
        <div id="traitImgs"></div>
      </div>

      <div id="btnRow">
        <button id="againBtn" class="pillBtn">å†æ¸¬ä¸€æ¬¡</button>
        <button id="downloadBtn" class="pillBtn">ä¸‹è¼‰çµæœåœ–</button>
      </div>

    </div>
  </section>

  <div id="shareStage" aria-hidden="true">
    <div id="shareCard"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
/* ========= é¡Œç›®ï¼ˆ25 é¡Œï½œå®Œæ•´ç‰ˆæ•˜è¿°ï¼‰ ========= */
const QUESTIONS = [
  { q:"1. å¹³å¸¸åšäº‹æ™‚ï¼Œèº«é‚Šçš„äººæœ€å¸¸æ€éº¼å½¢å®¹ä½ ï¼Ÿ", a:["æƒ³æ³•å¾ˆå¤šã€é»å­ä¸€ç›´å†’å‡ºä¾†ï¼Œè…¦è¢‹è½‰å¾ˆå¿«","è·Ÿä½ ç›¸è™•å¾ˆèˆ’æœï¼Œæœƒè‡ªç„¶æƒ³è·Ÿä½ åˆä½œ","åšäº‹å‰ä¸€å®šæœƒå…ˆæƒ³é¢¨éšªï¼Œä¸å¤ªæœƒäº‚è¡","æ±è¥¿æ•´ç†å¾—å¾ˆå®Œæ•´ï¼Œç´°ç¯€ä¸å¤ªæœƒå‡ºéŒ¯"]},
  { q:"2. ä½ ã€Œæ¯”è¼ƒå¸Œæœ›ã€åˆ¥äººæ€éº¼çœ‹ä½ ï¼Ÿ", a:["å€‹æ€§æº«å’Œã€å¥½ç›¸è™•ï¼Œå¤§å®¶éƒ½é¡˜æ„æ‰¾ä½ ","èªªåˆ°åšåˆ°ã€äº¤è¾¦çš„äº‹å¯ä»¥æ”¾å¿ƒäº¤çµ¦ä½ ","åšæ±ºå®šå¾ˆå¿«ï¼Œé—œéµæ™‚åˆ»èƒ½æ‹æ¿","è·Ÿä½ åœ¨ä¸€èµ·æœƒè¦ºå¾—æœ‰èƒ½é‡ã€æœ‰å¸¶å‹•æ„Ÿ"]},
  { q:"3. å“ªä¸€ç¨®æƒ…æ³ï¼Œæœƒè®“ä½ æœ€æœ‰æˆå°±æ„Ÿï¼Ÿ", a:["æ•´å€‹å±€å‹¢åœ¨ä½ æŒæ¡ä¸­ï¼Œäº‹æƒ…ç…§ä½ é æœŸèµ°","è…¦ä¸­æƒ³äº†å¾ˆä¹…çš„æƒ³æ³•ï¼ŒçœŸçš„è¢«åšå‡ºä¾†","è¢«å¤§å®¶è‚¯å®šã€è¢«éœ€è¦ã€è¢«çœ‹è¦‹","æŠ“åˆ°å°çš„æ™‚æ©Ÿï¼Œé †å‹¢å‡ºæ‰‹è€Œä¸”æ•ˆæœå¾ˆå¥½"]},
  { q:"4. åœ˜éšŠåˆä½œæ™‚ï¼Œä½ è‡ªç„¶æœƒç«™åœ¨å“ªå€‹ä½ç½®ï¼Ÿ", a:["è² è²¬ä¸Ÿæƒ³æ³•ã€å®šæ–¹å‘ã€é–‹æ–°å¯èƒ½","å°å¤–æºé€šã€å”èª¿äººã€ä¸²è³‡æº","æ’æ™‚ç¨‹ã€æ§é€²åº¦ï¼Œç¢ºä¿äº‹æƒ…å¾€å‰èµ°","å»ºç«‹æµç¨‹ã€é¡§å“è³ªï¼Œé¿å…å‡ºéŒ¯"]},
  { q:"5. åœ¨ä¸€ç¾¤äººè£¡ï¼Œä½ é€šå¸¸æ˜¯ï¼Ÿ", a:["æƒ³åˆ°ä»€éº¼å°±æƒ³è©¦è©¦çœ‹ï¼Œä¸å¤ªè¢«æ¡†ä½","å¸¶å‹•æ°£æ°›ã€è®“å¤§å®¶æ¯”è¼ƒæœ‰äº’å‹•","å…ˆè§€å¯Ÿç‹€æ³ï¼Œæƒ³æ¸…æ¥šå†è¡Œå‹•","è©±ä¸å¤šï¼Œä½†è©²åšçš„äº‹éƒ½æœƒç©©ç©©å®Œæˆ"]},
  { q:"6. ç•¶å£“åŠ›å¾ˆå¤§æ™‚ï¼Œä½ æœ€å¸¸é ä»€éº¼æ’éå»ï¼Ÿ", a:["å‘Šè¨´è‡ªå·±è¦å†åŠªåŠ›ä¸€é»ï¼Œç¡¬æ’ä¹Ÿè¦æ’","éˆå…‰ä¸€é–ƒï¼Œçªç„¶æƒ³åˆ°è§£æ³•","æ‰¾äººèŠèŠæˆ–è«‹äººå¹«å¿™","é æµç¨‹ã€æ•ˆç‡ï¼ŒæŠŠäº‹æƒ…ä¸€å€‹å€‹è§£æ‰"]},
  { q:"7. å“ªä¸€å¥è©±ï¼Œæœ€åƒä½ å…§å¿ƒçš„çœŸå¯¦ç‹€æ…‹ï¼Ÿ", a:["æˆ‘ç¿’æ…£è‡ªå·±æƒ³æ¸…æ¥šå†èªª","æˆ‘éœ€è¦æœ‰äººäº’å‹•ï¼Œæ‰æ¯”è¼ƒæœ‰å‹•åŠ›","æˆ‘å¸¸å¸¸æƒ³å¤ªä¹…ï¼Œé²é²ä¸‹ä¸äº†æ±ºå®š","æˆ‘çœŸçš„å—ä¸äº†æ‹–æ‹–æ‹‰æ‹‰"]},
  { q:"8. é‡åˆ°é‡è¦é¸æ“‡æ™‚ï¼Œä½ é€šå¸¸æœƒï¼Ÿ", a:["è½è½åˆ¥äººçš„ç¶“é©—ï¼Œå†æ±ºå®š","çœ‹å¤§å®¶æ€éº¼é¸ï¼Œæ„Ÿå—ä¸€ä¸‹æ°£æ°›","åˆ—æ¸…æ¥šåˆ©å¼Šã€é¢¨éšªèˆ‡æˆæœ¬","æ„Ÿè¦ºå°äº†å°±è¡ï¼Œé‚Šèµ°é‚Šèª¿æ•´"]},
  { q:"9. ä½ æœ€æ€•è¢«è²¼ä¸Šå“ªä¸€ç¨®æ¨™ç±¤ï¼Ÿ", a:["çœ‹èµ·ä¾†å¾ˆæ··ã€æ²’åœ¨èªçœŸ","ç„¡èŠã€æ²’ç‰¹è‰²ã€ä¸è¢«æ³¨æ„","å¥½åƒæ²’æœ‹å‹ã€å¾ˆé‚Šç·£","æ€è€ƒå¾ˆäº‚ã€äº‹æƒ…å¸¸å‡ºåŒ…"]},
  { q:"10. å“ªä¸€ç¨®å·¥ä½œç•«é¢ï¼Œä½ æ¯”è¼ƒæœ‰æ„Ÿï¼Ÿ", a:["è«‡æ¢ä»¶ã€è²·ä½è³£é«˜ã€æŒæ¡ä¸»å°æ¬Š","å»ºç«‹åˆ¶åº¦ã€æµç¨‹ã€SOP","å¿«é€Ÿè©¦éŒ¯ã€æ“´å¼µã€é–‹æ–°å±€","å’Œäººäº’å‹•ã€åˆä½œã€å»ºç«‹é—œä¿‚"]},
  { q:"11.å¦‚æœå¯ä»¥é¸ï¼Œä½ æœ€æƒ³é¿é–‹å“ªä¸€ç¨®äº‹ï¼Ÿ", a:["ä¸€ç›´æƒ³æ–°ç­–ç•¥ã€æ–°æ–¹å‘","åˆ†å·¥å”èª¿ã€çµ„ç¹”æ¶æ§‹","æµç¨‹è¨­è¨ˆã€ç³»çµ±æ•´ç†","ä¸€ç›´å°äººã€æƒ…ç·’å‹å‹•"]},
  { q:"12. åœ¨åœ˜éšŠè£¡ï¼Œå¤§å®¶æœ€å¸¸æœŸå¾…ä½ åšä»€éº¼ï¼Ÿ", a:["æ‰¾å•é¡Œã€æŒ‡å‡ºå“ªè£¡æ€ªæ€ªçš„","ææ–°æ–¹å‘ã€æ–°é»å­","å°å¤–é€£çµè³‡æºã€æ‹‰åˆä½œ","æŠŠäº‹æƒ…çœŸæ­£åšå®Œã€æ”¶å¥½"]},
  { q:"13. å“ªä¸€ä»¶äº‹æœ€å®¹æ˜“è®“ä½ å¡é—œï¼Ÿ", a:["ä¸»å‹•ç¶“ç‡Ÿäººéš›é—œä¿‚","æ¯”åƒ¹ã€ç®— CP å€¼","æ†‘ç©ºæƒ³æ–°é»å­","æœƒè¦æ±‚ç´°ç¯€ã€æ‰¾éŒ¯èª¤"]},
  { q:"14. ä½ æœ€æœ‰è‡ªä¿¡çš„ä¸€é …èƒ½åŠ›æ˜¯ï¼Ÿ", a:["æƒ³å‡ºæ²’äººæƒ³éçš„é»å­","æŠŠå°çš„äººæ”¾åœ¨å°çš„ä½ç½®","ç®—å‡ºæœ€åˆ’ç®—ã€æœ€æœ‰æ•ˆç‡çš„æ–¹æ¡ˆ","æŠŠäº‹æƒ…åšåˆ°æ¨™æº–ã€ä¸å‡ºå·®éŒ¯"]},
  { q:"15. å“ªä¸€ç¨®ç‹€æ³æœ€å®¹æ˜“è®“ä½ å…§è€—ï¼Ÿ", a:["åœ˜éšŠäººéš›æ°£æ°›å¾ˆå·®","æ²’è¦å‰‡ã€æ²’æ­¥é©Ÿã€å¾ˆæ··äº‚","é‚è¼¯å‰å¾Œä¸é€šã€èªªä¸æ¸…æ¥š","ä¸€ç›´åšé‡è¤‡ã€æ²’æˆé•·çš„äº‹"]},
  { q:"16. ä½ ç‰¹åˆ¥å—ä¸äº†å“ªä¸€ç¨®äººï¼Ÿ", a:["ä¸å®ˆç•Œç·šã€æƒ…ç·’å‹’ç´¢","ä¸€æˆä¸è®Šã€ä¸æƒ³æ”¹è®Š","æ­»ä¸è®Šé€šã€æ²’æœ‰å½ˆæ€§","åšäº‹å¾ˆäº‚ã€ä¸æ”¶å°¾"]},
  { q:"17.åˆ¥äººæœ€å¸¸ç¨±è®šä½ ä»€éº¼ï¼Ÿ", a:["å¾ˆæœƒæ¨å‹•äº‹æƒ…ã€å¾ˆæœƒèªªæœ","å¾ˆæœƒè«‡åˆ¤ã€æ‹¿åˆ°å¥½æ¢ä»¶","çœ‹å•é¡Œå¾ˆæº–ï¼Œä¸€é‡è¦‹è¡€","æƒ³æ³•å¾ˆç‰¹åˆ¥ã€å¾ˆæœ‰å‰µæ„"]},
  { q:"18. å“ªä¸€ä»¶äº‹ä½ æœ€æ²’æŠŠæ¡ï¼Ÿ", a:["æŠŠæµç¨‹è®Šå¾—æ›´å¥½ã€æ›´é †","åˆ¤æ–·è¶¨å‹¢ã€æŠ“å¤§æ–¹å‘","ä¸€ç›´æƒ³å‡ºæ–°ç©æ³•","é•·æ™‚é–“è·Ÿäººäº’å‹•ä¸ç´¯"]},
  { q:"19. ä»€éº¼æ™‚å€™ä½ æœƒæœ€é–‹å¿ƒï¼Ÿ", a:["è‡ªå·±çš„å‰µæ„è¢«æ¡ç”¨","èªè­˜åˆ°å°çš„äººã€å¥½å¤¥ä¼´","æ’¿åˆ°å¥½åº·ã€åšå‡ºé«˜ CP çš„é¸æ“‡","ç³»çµ±é †é †è·‘ã€äº‹æƒ…å¾ˆç©©"]},
  { q:"20. å“ªä¸€ä»¶äº‹æœ€å®¹æ˜“è®“ä½ ç…©èºï¼Ÿ", a:["è¦å‰‡è¢«äº‚ç ´ã€æ²’åº•ç·š","ä¸€ç›´ç­‰ã€æ²’é€²åº¦","äººéš›é—œä¿‚å†·æ‰ã€æ°£æ°›æ€ª","ä¸çŸ¥é“æ€éº¼é…åˆã€å¾ˆæ··äº‚"]},
  { q:"21. å·¥ä½œæ™‚ï¼Œä½ æ¯”è¼ƒåƒå“ªä¸€å‹ï¼Ÿ", a:["ç©©ç©©æŠŠé—œã€å®ˆä½å“è³ª","æ¢ç†æ¸…æ¥šã€æµç¨‹æ§","é»å­å‹ã€å‰µæ„æ›","å¤–æ”¾å‹ã€äº’å‹•æ›"]},
  { q:"22. åˆ¥äººç”¨å“ªä¸€å€‹å½¢å®¹è©å½¢å®¹ä½ ï¼Œä½ æœƒè¦ºå¾—å¾ˆé©šè¨ï¼Ÿ", a:["å¾ˆç©©å®š","å¾ˆæœ‰æ¢ç†","å¾ˆæœ‰å‰µæ„","å¾ˆå¤–å‘"]},
  { q:"23. ä½ è¦ºå¾—è‡ªå·±åšä»€éº¼æœ€ä¸è²»åŠ›ï¼Ÿ", a:["å’Œäººå»ºç«‹é€£çµã€æ‹‰é—œä¿‚","çœ‹å‡ºæ©Ÿæœƒé»ã€åˆ¤æ–·æ™‚æ©Ÿ","å„ªåŒ–æµç¨‹ã€è®“äº‹æƒ…æ›´é †","ç™¼æƒ³æ–°æ–¹å‘ã€æ–°å¯èƒ½"]},
  { q:"24. å¿«æ’ä¸ä½æ™‚ï¼Œä½ æœ€å¸¸ä¾é ä»€éº¼ï¼Ÿ", a:["é‚è¼¯èˆ‡ç†æ€§åˆ¤æ–·","å¤©è³¦ç›´è¦ºã€æ„Ÿè¦º","æ‰¾äººå¹«å¿™ã€ä¸€èµ·æ‰›","å‘Šè¨´è‡ªå·±å†æ’ä¸€ä¸‹"]},
  { q:"25. äº‹æƒ…å®Œæˆå¾Œï¼Œä½ ç¬¬ä¸€å€‹åæ‡‰æ˜¯ï¼Ÿ", a:["å¥½å¥½æ…¶ç¥ä¸€ä¸‹","æ„Ÿè¬èº«é‚Šå¹«å¿™çš„äºº","æŠŠæ”¶å°¾ã€æ•´ç†åšå¥½","é–‹å§‹æƒ³ä¸‹ä¸€æ­¥è¦å¹¹å˜›"]},
];

/* ========= DBTS è¨ˆåˆ†ï¼ˆæ²¿ç”¨ï¼‰ ========= */
const SCORE_MAP = [
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{T:+1}, B:{S:+1}, C:{D:+1}, D:{B:+1} },
  { A:{S:+1}, B:{D:+1}, C:{B:+1}, D:{T:+1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{T:+1}, B:{D:+1}, C:{B:+1}, D:{S:+1} },
  { A:{S:+1}, B:{B:+1}, C:{T:+1}, D:{D:+1} },
  { A:{T:+1}, B:{B:+1}, C:{S:+1}, D:{D:+1} },
  { A:{T:+1}, B:{D:+1}, C:{B:+1}, D:{S:+1} },
  { A:{T:+1}, B:{S:+1}, C:{D:+1}, D:{B:+1} },
  { A:{D:-1}, B:{T:-1}, C:{S:-1}, D:{B:-1} },
  { A:{S:+1}, B:{D:+1}, C:{B:+1}, D:{T:+1} },
  { A:{B:-1}, B:{T:-1}, C:{D:-1}, D:{S:-1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{B:+1}, B:{T:+1}, C:{S:+1}, D:{D:+1} },
  { A:{S:+1}, B:{B:+1}, C:{D:+1}, D:{T:+1} },
  { A:{B:+1}, B:{T:+1}, C:{S:+1}, D:{D:+1} },
  { A:{B:+1}, B:{D:+1}, C:{T:+1}, D:{S:+1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{S:+1}, B:{D:+1}, C:{B:+1}, D:{T:+1} },
  { A:{S:+1}, B:{T:+1}, C:{D:+1}, D:{B:+1} },
  { A:{S:-1}, B:{T:-1}, C:{D:-1}, D:{B:-1} },
  { A:{B:+1}, B:{T:+1}, C:{S:+1}, D:{D:+1} },
  { A:{S:+1}, B:{D:+1}, C:{B:+1}, D:{T:+1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
];

function applyDelta(scores, delta){
  for(const k in delta) scores[k] = (scores[k] || 0) + delta[k];
}

function toPercentagesFromRaw(raw){
  const w = { D: Math.abs(raw.D||0), B: Math.abs(raw.B||0), T: Math.abs(raw.T||0), S: Math.abs(raw.S||0) };
  let sum = w.D + w.B + w.T + w.S;
  if(!sum) return { D:25, B:25, T:25, S:25 };

  let p = {
    D: Math.round(w.D / sum * 100),
    B: Math.round(w.B / sum * 100),
    T: Math.round(w.T / sum * 100),
    S: Math.round(w.S / sum * 100),
  };

  const total = p.D + p.B + p.T + p.S;
  const diff = 100 - total;
  if(diff !== 0){
    let best = "D", bestV = w.D;
    for(const k of ["B","T","S"]){ if(w[k] > bestV){ bestV=w[k]; best=k; } }
    p[best] += diff;
  }
  for(const k of ["D","B","T","S"]) p[k] = Math.max(0, Math.min(100, p[k]));
  return p;
}

function mapDBTS_to_8types(percentages){
  const { D, B, T, S } = percentages;
  const avg = (a,b)=>Math.round((a+b)/2);
  return {
    æŠ€å¸«:   avg(S, D),
    å‰µä½œè€…: D,
    æ˜æ˜Ÿ:   avg(D, B),
    æ”¯æŒè€…: B,
    åª’åˆè€…: avg(B, T),
    å•†äºº:   T,
    ç©è“„è€…: avg(T, S),
    åœ°ä¸»:   S,
  };
}

const ROLE_ORDER_8 = ["æŠ€å¸«","å‰µä½œè€…","æ˜æ˜Ÿ","æ”¯æŒè€…","åª’åˆè€…","å•†äºº","ç©è“„è€…","åœ°ä¸»"];
function pickRoleBy8Types(type8){
  let best = ROLE_ORDER_8[0], bestV = type8[best] ?? -Infinity;
  for(const k of ROLE_ORDER_8){
    const v = type8[k] ?? -Infinity;
    if(v > bestV){ bestV = v; best = k; }
  }
  return best;
}

function pickMainEnergy(percentages){
  let best="D", bestV=percentages.D;
  for(const k of ["B","T","S"]){
    if(percentages[k] > bestV){ bestV=percentages[k]; best=k; }
  }
  return best;
}

const ENERGY_IMAGE = {
  B:'https://i.ibb.co/DsQ5JfD/1-0.png',
  D:'https://i.ibb.co/8DyWr929/2-0.png',
  T:'https://i.ibb.co/Z12ZYMS1/3-0.png',
  S:'https://i.ibb.co/WWkXCyg6/4-0.png'
};

/* âœ… é›·é”é¢ç©é¡è‰²ï¼šè·Ÿè‘—æœ€é«˜èƒ½é‡èµ° */
const RADAR_THEME = {
  D: { stroke:"#16a34a", fill:"rgba(22,163,74,0.12)" },   // ç™¼é›»æ©Ÿï¼šç¶ 
  B: { stroke:"#dc2626", fill:"rgba(220,38,38,0.12)" },   // ç«ç„°ï¼šç´…
  T: { stroke:"#f59e0b", fill:"rgba(245,158,11,0.14)" },  // ç¯€å¥ï¼šé»ƒï¼ˆå¡«è‰²ç•¥æ·±ä¸€é»é»ï¼‰
  S: { stroke:"#6b7280", fill:"rgba(107,114,128,0.14)" }, // é‹¼éµï¼šéµç°
};

/* âœ… å„ç‰¹è³ªè§£æ */
const TRAIT_BLOCKS = {
  "å‰µä½œè€…": {
    title:"ğŸŒ± å‰µä½œè€… Creatorï½œå¾ 0 åˆ° 1 çš„éˆæ„Ÿå¼•æ“",
    oneLine:"ä»£è¡¨äººç‰©ï¼šæŸ¥ç†ãƒ»å¸ƒè˜­æ£®ï½œã€Œä¸–ç•Œé‚„æ²’æº–å‚™å¥½ï¼Œä½†ä½ å·²ç¶“çœ‹è¦‹æœªä¾†ã€‚ã€",
    adv:`â€¢ é»å­æºæºä¸çµ•ã€ç›´è¦ºè¶…æº–\nâ€¢ æœ‰é è¦‹ã€æ•¢å†’éšªã€æ¨‚è§€\nâ€¢ è¶…æœƒã€Œé–‹å§‹ã€ï¼Œä¸æ€•å¾é›¶å‡ºç™¼`,
    blind:`â€¢ æ²’è€å¿ƒã€æ™‚æ©Ÿæ„Ÿè¼ƒå¼±\nâ€¢ æƒ³æ³•å¤ªå¤šï¼Œåè€Œé›£å®Œæˆ\nâ€¢ ä¸€å€‹äººç¡¬æ’æœƒå¾ˆå­¤å–®`,
    wealth:`â€¢ åªåšã€Œå‰µé€ ã€ï¼šç­–ç•¥ã€ç”¢å“ã€å‰µæ„\nâ€¢ æ‰¾å°æ­æª”ï¼šæ”¯æŒè€…ï¼‹ç©è“„è€…\nâ€¢ å·¥å…·å¤–åŒ…å¤§è…¦ï¼Œå°ˆæ³¨éˆæ„Ÿ\nâ€¢ ä¸€å®šè¦ã€Œå‹•æ‰‹åšã€ï¼Œä¸è¦åªæƒ³\nâœ¨ ä½ ä¸æ˜¯ä¸å¤ åŠªåŠ›ï¼Œåªæ˜¯ä¸è©²ä¸€å€‹äººæŠŠå…¨éƒ¨åšå®Œã€‚`
  },
  "æ˜æ˜Ÿ": {
    title:"â­ æ˜æ˜Ÿ Starï½œç”¨å½±éŸ¿åŠ›æ‰“é€ å“ç‰Œ",
    oneLine:"ä»£è¡¨äººç‰©ï¼šæ­æ™®æ‹‰ãƒ»æº«èŠ™è•¾ï½œã€Œä½ ç«™åœ¨é‚£è£¡ï¼Œæœ¬èº«å°±æ˜¯åƒ¹å€¼ã€‚ã€",
    adv:`â€¢ å¤©ç”Ÿå¸ç›ã€æœƒèªªæ•…äº‹\nâ€¢ æºé€šåŠ›å¼·ã€èƒ½æ¿€å‹µäººå¿ƒ\nâ€¢ å€‹äººå“ç‰Œå°±æ˜¯ä½ çš„è³‡ç”¢`,
    blind:`â€¢ å¤ªåœ¨æ„å½¢è±¡ï¼Œå¿½ç•¥å…§å®¹\nâ€¢ éåº¦å¼·å‹¢ï¼Œå®¹æ˜“å¼•ç™¼çˆ­è­°\nâ€¢ ç´°ç¯€èˆ‡ç³»çµ±æœƒæ¶ˆè€—ä½ `,
    wealth:`â€¢ ä¸»æ‰“æºé€šã€è¡ŒéŠ·ã€é ˜å°\nâ€¢ ç”¨çœŸèª ç´¯ç©å½±éŸ¿åŠ›\nâ€¢ ç´°ç¯€äº¤çµ¦åœ˜éšŠ\nâ€¢ åª’åˆè€…ï¼‹åœ°ä¸»æ˜¯ç¥éšŠå‹\nâœ¨ ä½ ä¸æ˜¯æ„›å‡ºé¢¨é ­ï¼Œæ˜¯ä½ çœŸçš„èƒ½ç…§äº®åˆ¥äººã€‚`
  },
  "æ”¯æŒè€…": {
    title:"ğŸ¤ æ”¯æŒè€… Supporterï½œæŠŠäººèšåœ¨ä¸€èµ·çš„äºº",
    oneLine:"ä»£è¡¨äººç‰©ï¼šå‚‘å…‹ãƒ»å¨çˆ¾è¨±ï½œã€Œä½ ä¸åªå¸¶äººèµ°ï¼Œé‚„è®“äººé¡˜æ„è·Ÿä½ èµ°ã€‚ã€",
    adv:`â€¢ è¶…å¼·äººéš›åŠ›ã€è¶…æœƒçµ¦ä¿¡å¿ƒ\nâ€¢ èƒ½æŠŠåƒ¹å€¼è®Šæˆè¡Œå‹•\nâ€¢ åœ˜éšŠæ°£æ°›çš„éˆé­‚äººç‰©`,
    blind:`â€¢ ä¸è€æ•¸å­—èˆ‡ç´°ç¯€\nâ€¢ ä¸€å€‹äººæ™‚æœƒè¿·å¤±\nâ€¢ ä¸é©åˆé•·æ™‚é–“ç¨ç«‹ä½œæ¥­`,
    wealth:`â€¢ é ˜å°ã€è¡ŒéŠ·ã€æ¥­å‹™ã€é¡§å•\nâ€¢ ä¸€å®šè¦åœ¨åœ˜éšŠä¸­\nâ€¢ å°ˆæ³¨ã€Œäººã€è€Œä¸æ˜¯ã€Œè¡¨æ ¼ã€\nâœ¨ çœŸæ­£çš„é ˜å°ï¼Œä¸æ˜¯è¡æœ€å¿«ï¼Œè€Œæ˜¯è®“å¤§å®¶éƒ½å‹•èµ·ä¾†ã€‚`
  },
  "åª’åˆè€…": {
    title:"ğŸ”— åª’åˆè€… Deal Makerï½œæŠŠå°çš„äººæ”¾åœ¨å°çš„ä½ç½®",
    oneLine:"ä»£è¡¨äººç‰©ï¼šå”ç´ãƒ»å·æ™®ï½œã€Œä½ ä¸æ˜¯å‰µé€ ç”¢å“ï¼Œä½ å‰µé€ æ©Ÿæœƒã€‚ã€",
    adv:`â€¢ å°æ™‚æ©Ÿè¶…æ•æ„Ÿ\nâ€¢ ä¸€å°ä¸€é—œä¿‚ç¶“ç‡Ÿé«˜æ‰‹\nâ€¢ è«‡åˆ¤ã€æ’®åˆã€å€Ÿå‹¢ä¸€æµ`,
    blind:`â€¢ æ³¨æ„åŠ›åˆ†æ•£\nâ€¢ æƒ³è®“æ‰€æœ‰äººéƒ½æ»¿æ„\nâ€¢ æ¶æ§‹ä¸å¤ æœƒå¤±æ§`,
    wealth:`â€¢ å°ˆæ³¨å‰ç·šè«‡æ¡ˆã€åª’åˆ\nâ€¢ å»ºç«‹äººè„ˆç¶²çµ¡\nâ€¢ é¿é–‹ç³»çµ±èˆ‡ç´°ç¯€å·¥ä½œ\nâœ¨ ä½ å­˜åœ¨çš„æ„ç¾©ï¼Œå°±æ˜¯è®“äº‹æƒ…ã€Œç™¼ç”Ÿã€ã€‚`
  },
  "å•†äºº": {
    title:"ğŸ’¹ å•†äºº Traderï½œä½è²·é«˜è³£çš„æ™‚æ©Ÿçµäºº",
    oneLine:"ä»£è¡¨äººç‰©ï¼šå–¬æ²»ãƒ»ç´¢ç¾…æ–¯ï½œã€Œä½ æœ€å€¼éŒ¢çš„ï¼Œæ˜¯ä½ å°å¸‚å ´çš„æ„Ÿè¦ºã€‚ã€",
    adv:`â€¢ è¶…æœƒæŠ“ CP å€¼\nâ€¢ æ™‚æ©Ÿæ„Ÿã€æ´å¯ŸåŠ›å¼·\nâ€¢ è«‡åˆ¤èˆ‡æœå‹™èƒ½åŠ›é«˜`,
    blind:`â€¢ çœ‹ä¸æ¸…å¤§å±€\nâ€¢ ä¿¡å¿ƒèµ·ä¼å¤§\nâ€¢ å‰µæ„èˆ‡ç­–ç•¥è¼ƒå¼±`,
    wealth:`â€¢ æŠ•è³‡ã€æ¡è³¼ã€åŸ·è¡Œã€æœå‹™\nâ€¢ ç™¼æ®ä½è²·é«˜è³£å¤©è³¦\nâ€¢ ä¸ç”¨é€¼è‡ªå·±ç•¶å‰µæ„ç¸½ç›£\nâœ¨ ä½ ä¸æ˜¯æ…¢ï¼Œæ˜¯ä½ çŸ¥é“ä»€éº¼æ™‚å€™è©²å‹•ã€‚`
  },
  "ç©è“„è€…": {
    title:"ğŸ¢ ç©è“„è€… Accumulatorï½œæ…¢æ…¢å»èµ°æœ€é ",
    oneLine:"ä»£è¡¨äººç‰©ï¼šè¯å€«ãƒ»å·´è²ç‰¹ï½œã€Œä½ ç”¨è€å¿ƒï¼Œæ›è‡ªç”±ã€‚ã€",
    adv:`â€¢ ç³»çµ±æ€ç¶­ã€é¢¨éšªæ§ç®¡\nâ€¢ æ·±åº¦ç ”ç©¶ã€ä¸è¡å‹•\nâ€¢ æœ€ç©©å®šçš„è²¡å¯Œå‹`,
    blind:`â€¢ è¡Œå‹•æ…¢ï¼Œè¢«èª¤æœƒæ‹–å»¶\nâ€¢ ç¤¾äº¤æ›å…‰è¼ƒå¼±`,
    wealth:`â€¢ åƒ¹å€¼æŠ•è³‡ã€é•·æœŸæŒæœ‰\nâ€¢ è¨­å®šã€Œå‡ºæ‰‹æ¨™æº–ã€\nâ€¢ æ‰¾æŠ€å¸«ï¼‹æ”¯æŒè€…åˆä½œ\nâœ¨ æ…¢ï¼Œä¸æ˜¯å•é¡Œï¼›äº‚å‹•ï¼Œæ‰æ˜¯ã€‚`
  },
  "åœ°ä¸»": {
    title:"ğŸ— åœ°ä¸» Landlordï½œè®“è³‡ç”¢æ›¿ä½ å·¥ä½œ",
    oneLine:"ä»£è¡¨äººç‰©ï¼šæ‹‰å…‹å¸Œç±³ãƒ»ç±³å¡”çˆ¾ï½œã€Œä½ ä¸åœ¨å ´ï¼ŒéŒ¢ä¹Ÿæœƒé€²ä¾†ã€‚ã€",
    adv:`â€¢ æ§åˆ¶å…¨å±€ã€é‡è¦–æ•ˆç‡\nâ€¢ æ“…é•·å¾Œç«¯ã€è³‡ç”¢ç®¡ç†\nâ€¢ å–œæ­¡å®‰éœè³ºéŒ¢`,
    blind:`â€¢ ä¸æ„›äººéš›äº’å‹•\nâ€¢ å°æ›å…‰èˆ‡è¡ŒéŠ·æ²’èˆˆè¶£`,
    wealth:`â€¢ ç³»çµ±ã€æ•¸æ“šã€è³‡ç”¢å„ªåŒ–\nâ€¢ ç•¶å¹•å¾Œå¤§è…¦\nâ€¢ é¿é–‹æ¼”è¬›èˆ‡éŠ·å”®\nâœ¨ ä½ ä¸æ˜¯å†·ï¼Œä½ åªæ˜¯æŠŠèƒ½é‡ç”¨åœ¨å°çš„åœ°æ–¹ã€‚`
  },
  "æŠ€å¸«": {
    title:"âš™ï¸ æŠ€å¸« Mechanicï½œæŠŠç³»çµ±åšåˆ°æ¥µè‡´",
    oneLine:"ä»£è¡¨äººç‰©ï¼šé¦¬å…‹ãƒ»ç¥–å…‹æŸï½œã€Œä½ è®“ä¸€åˆ‡é‹è½‰å¾—æ›´å¥½ã€‚ã€",
    adv:`â€¢ ç³»çµ±å»ºæ§‹èˆ‡å„ªåŒ–\nâ€¢ å®Œæˆåº¦é«˜ã€é‡å“è³ª\nâ€¢ ä¸€å€‹äººä¹Ÿèƒ½é«˜æ•ˆ`,
    blind:`â€¢ å¤ªé‘½ç´°ç¯€\nâ€¢ ç¤¾äº¤å ´åˆè€—èƒ½`,
    wealth:`â€¢ æ¥æ‰‹ç¾æœ‰ç³»çµ±ä¾†å„ªåŒ–\nâ€¢ å°å°ˆæ¡ˆå®Œæˆæ„Ÿæœ€é‡è¦\nâ€¢ ä¸å¿…å¾ 0 é–‹å§‹\nâœ¨ æ²’æœ‰ä½ ï¼Œå‰µæ„åªæœƒåœåœ¨æƒ³åƒã€‚`
  }
};

function analyzeTalent(answerArray){
  const raw = { D:0, B:0, T:0, S:0 };
  for(let i=0;i<QUESTIONS.length;i++){
    const v = answerArray[i];
    const letter = ["A","B","C","D"][v-1];
    applyDelta(raw, SCORE_MAP[i][letter]);
  }
  const percentages = toPercentagesFromRaw(raw);
  const type8 = mapDBTS_to_8types(percentages);
  const mainEnergy = pickMainEnergy(percentages);
  const final_trait = pickRoleBy8Types(type8);
  return { raw, percentages, type8, mainEnergy, final_trait };
}

/* ========= ä½œç­”æµç¨‹ ========= */
let currentIndex = 0;
const answers = new Array(QUESTIONS.length);
const $ = (id)=>document.getElementById(id);

function startQuiz(){
  $("startPage").style.display="none";
  $("quizPage").style.display="flex";
  renderQuestion();
}

function renderQuestion(){
  const q = QUESTIONS[currentIndex];
  const total = QUESTIONS.length;
  $("progress").innerText = `ç¬¬ ${currentIndex+1} / ${total} é¡Œ`;
  $("questionTitle").innerText = q.q;

  const selected = answers[currentIndex];
  $("options").innerHTML = q.a.map((txt,i)=>{
    const isSel = selected === (i+1);
    return `<div class="option ${isSel ? 'selected' : ''}" data-idx="${i}">${String.fromCharCode(65+i)}ï½œ${txt}</div>`;
  }).join("");

  $("options").querySelectorAll(".option").forEach(el=>{
    el.addEventListener("click", ()=> pickOption(parseInt(el.dataset.idx,10)));
  });

  $("prevBtn").disabled = currentIndex===0;
  $("nextBtn").innerText = currentIndex === total-1 ? "çœ‹çµæœ âœ" : "ä¸‹ä¸€é¡Œ âœ";
}

function pickOption(idx){
  answers[currentIndex] = idx+1;
  renderQuestion();
  if(currentIndex === QUESTIONS.length - 1) return;
  setTimeout(()=>{
    currentIndex++;
    renderQuestion();
    window.scrollTo(0,0);
  }, 120);
}

function prevQ(){
  if(currentIndex>0){
    currentIndex--;
    renderQuestion();
    window.scrollTo(0,0);
  }
}

function nextQ(){
  const a = answers[currentIndex];
  if(!a){ alert("é€™ä¸€é¡Œé‚„æ²’ä½œç­”å–”ï½"); return; }
  if(currentIndex < QUESTIONS.length-1){
    currentIndex++;
    renderQuestion();
    window.scrollTo(0,0);
  }else{
    showResult();
  }
}

function restartQuiz(){
  for(let i=0;i<answers.length;i++) answers[i] = undefined;
  currentIndex = 0;
  $("resultPage").style.display = "none";
  $("quizPage").style.display   = "none";
  $("startPage").style.display  = "flex";
  window.scrollTo(0,0);
}

function resizeCanvasToDisplaySize(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  const size = Math.floor(Math.min(rect.width, rect.height)) || 420;
  const needW = Math.floor(size * dpr);
  const needH = Math.floor(size * dpr);
  if(canvas.width !== needW || canvas.height !== needH){
    canvas.width = needW;
    canvas.height = needH;
  }
  return { size, dpr };
}

/* ========= é›·é”åœ– ========= */
function drawRadar(type8, mainEnergyKey="D"){
  const c = $("radar");
  const ctx = c.getContext("2d");
  const { size, dpr } = resizeCanvasToDisplaySize(c);

  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,c.width,c.height);
  ctx.scale(dpr, dpr);

  const theme = RADAR_THEME[mainEnergyKey] || RADAR_THEME.D;

  const S = size;
  const cX = S/2, cY = S/2;

  const OUT_PAD = Math.max(120, Math.round(S * 0.28));
  const half = (S/2) - OUT_PAD;

  const left = cX - half, right = cX + half;
  const top  = cY - half, bottom = cY + half;

  const r = half / 0.9238795325;

  const drawSquare = (h)=>{
    ctx.beginPath();
    ctx.moveTo(cX - h, cY - h);
    ctx.lineTo(cX + h, cY - h);
    ctx.lineTo(cX + h, cY + h);
    ctx.lineTo(cX - h, cY + h);
    ctx.closePath();
    ctx.stroke();
  };

  const octVertices = (rr)=>{
    const pts = [];
    for(let i=0;i<8;i++){
      const ang = (-90 + i*45) * Math.PI/180;
      pts.push({ x: cX + rr*Math.cos(ang), y: cY + rr*Math.sin(ang) });
    }
    return pts;
  };

  const drawOct = (rr)=>{
    const vs = octVertices(rr);
    ctx.beginPath();
    ctx.moveTo(vs[0].x, vs[0].y);
    for(let i=1;i<vs.length;i++) ctx.lineTo(vs[i].x, vs[i].y);
    ctx.closePath();
    ctx.stroke();
  };

  // å¤–æ¡†æ­£æ–¹å½¢
  ctx.save();
  ctx.setLineDash([]);
  ctx.strokeStyle = "#cfcfcf";
  ctx.lineWidth = Math.max(1.0, S * 0.0030);   // âœ… æ¯”ä½ åŸæœ¬å†ç´°ä¸€é»é»ï¼ˆæ›´ç²¾ç·»ï¼‰
  drawSquare(half);
  ctx.restore();

  // å…«é‚Šå½¢å…©å±¤
  const octIn = r * 0.42;
  const octOut = r * 0.84;

  ctx.save();
  ctx.setLineDash([]);
  ctx.strokeStyle = "#d0d0d0";
  ctx.lineWidth = Math.max(1.0, S * 0.0030);   // âœ… ç·šä¹Ÿç´°ä¸€é»
  drawOct(octIn);
  drawOct(octOut);
  ctx.restore();

  // é»ƒé»å®šä½
  const dotR   = Math.max(3, Math.round(S * 0.010));
  const dotGap = Math.max(14, Math.round(S * 0.038));
  const textGap = Math.max(16, Math.round(S * 0.048));
  const fontSize = Math.max(12, Math.round(S * 0.034));

  const P = {
    "æŠ€å¸«":   { dotX: left  - dotGap, dotY: top    - dotGap,  textX: left  - dotGap - textGap, textY: top    - dotGap - textGap, align:"right" },
    "å‰µä½œè€…": { dotX: cX,            dotY: top    - dotGap,  textX: cX,                     textY: top    - dotGap - textGap, align:"center" },
    "æ˜æ˜Ÿ":   { dotX: right + dotGap, dotY: top    - dotGap,  textX: right + dotGap + textGap, textY: top  - dotGap - textGap, align:"left" },
    "æ”¯æŒè€…": { dotX: right + dotGap, dotY: cY,              textX: right + dotGap + textGap, textY: cY,                      align:"left" },
    "åª’åˆè€…": { dotX: right + dotGap, dotY: bottom + dotGap, textX: right + dotGap + textGap, textY: bottom + dotGap + textGap, align:"left" },
    "å•†äºº":   { dotX: cX,            dotY: bottom + dotGap,  textX: cX,                     textY: bottom + dotGap + textGap, align:"center" },
    "ç©è“„è€…": { dotX: left  - dotGap, dotY: bottom + dotGap, textX: left  - dotGap - textGap, textY: bottom + dotGap + textGap, align:"right" },
    "åœ°ä¸»":   { dotX: left  - dotGap, dotY: cY,              textX: left  - dotGap - textGap, textY: cY,                      align:"right" },
  };

  // å°„ç·š
  ctx.save();
  ctx.setLineDash([S * 0.010, S * 0.010]);
  ctx.strokeStyle = "#d9d9d9";
  ctx.lineWidth = Math.max(1.0, S * 0.0028);   // âœ… å°„ç·šä¹Ÿç´°ä¸€é»
  ctx.lineCap = "butt";

  ctx.beginPath();
  const rayOrder = ["æŠ€å¸«","å‰µä½œè€…","æ˜æ˜Ÿ","æ”¯æŒè€…","åª’åˆè€…","å•†äºº","ç©è“„è€…","åœ°ä¸»"];
  for(const name of rayOrder){
    ctx.moveTo(cX, cY);
    ctx.lineTo(P[name].dotX, P[name].dotY);
  }
  ctx.stroke();
  ctx.restore();

  // ä¸­é–“å››å­—
  const midR = (octIn + octOut) / 2;
  ctx.save();
  const midFont = Math.max(12, Math.round(S * 0.038));
  ctx.font = `${midFont}px 'Noto Sans TC'`;
  ctx.fillStyle = "rgba(120,120,120,0.24)";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("ç™¼é›»æ©Ÿ", cX, cY - midR);

  ctx.save();
  ctx.translate(cX + midR, cY);
  ctx.rotate(Math.PI/2);
  ctx.fillText("ç«ç„°", 0, 0);
  ctx.restore();

  ctx.fillText("ç¯€å¥", cX, cY + midR);

  ctx.save();
  ctx.translate(cX - midR, cY);
  ctx.rotate(-Math.PI/2);
  ctx.fillText("é‹¼éµ", 0, 0);
  ctx.restore();
  ctx.restore();

  // é»ƒé» + å¤–åœˆæ–‡å­—
  ctx.font = `${fontSize}px 'Noto Sans TC'`;
  ctx.textBaseline = "middle";

  const labels = ["æŠ€å¸«","å‰µä½œè€…","æ˜æ˜Ÿ","æ”¯æŒè€…","åª’åˆè€…","å•†äºº","ç©è“„è€…","åœ°ä¸»"];
  for (const name of labels) {
    const pos = P[name];
    ctx.beginPath();
    ctx.fillStyle = "#f2c94c";
    ctx.arc(pos.dotX, pos.dotY, dotR, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#000";
    ctx.textAlign = pos.align;
    ctx.fillText(name, pos.textX, pos.textY);
  }

  // âœ… é›·é”é¢ç©ï¼šé‚Šç•Œç”¨ç¬¬äºŒåœˆå…«é‚Šå½¢
  const polyOut = octVertices(octOut);
  const cross = (ax, ay, bx, by) => ax*by - ay*bx;

  function rayIntersectPolygonMaxT(poly, ux, uy){
    let bestT = Infinity;
    for(let i=0;i<poly.length;i++){
      const p1 = poly[i];
      const p2 = poly[(i+1)%poly.length];
      const vx = p2.x - p1.x;
      const vy = p2.y - p1.y;

      const wx = p1.x - cX;
      const wy = p1.y - cY;

      const denom = cross(ux, uy, vx, vy);
      if(Math.abs(denom) < 1e-9) continue;

      const t = cross(wx, wy, vx, vy) / denom;
      const s = cross(wx, wy, ux, uy) / denom;

      if(t >= 0 && s >= 0 && s <= 1){
        if(t < bestT) bestT = t;
      }
    }
    return bestT;
  }

  function mapValueToK(value){
    const v = Math.max(0, Math.min(100, value || 0));
    let radius;
    if(v <= 30){
      radius = octIn * (v / 30);
    }else if(v <= 70){
      radius = octIn + (octOut - octIn) * ((v - 30) / 40);
    }else{
      radius = octOut;
    }
    return radius / octOut;
  }

  const angles = [-135,-90,-45,0,45,90,135,180].map(a=>a*Math.PI/180);
  const values = labels.map(k => (type8?.[k] ?? 0));
  const pts = [];

  for(let i=0;i<8;i++){
    const a = angles[i];
    const ux = Math.cos(a), uy = Math.sin(a);
    const tOuter = rayIntersectPolygonMaxT(polyOut, ux, uy);

    const k = mapValueToK(values[i]);
    const t = tOuter * k;

    pts.push({ x: cX + ux * t, y: cY + uy * t });
  }

  ctx.beginPath();
  ctx.moveTo(pts[0].x, pts[0].y);
  for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].x, pts[i].y);
  ctx.closePath();

  // âœ… é‡é»ï¼šé¢ç©é¡è‰²è·Ÿè‘—æœ€é«˜èƒ½é‡
  ctx.fillStyle = theme.fill;                 
  ctx.strokeStyle = theme.stroke;
  ctx.lineWidth = Math.max(1.4, S * 0.0050);  // âœ… ç´°ä¸€é»ã€ä½†ä»ç„¶æ¸…æ™°
  ctx.fill();
  ctx.stroke();
}

/* ========= ä¸‹è¼‰æ•´é çµæœï¼ˆIG åˆ†äº«å¡ç•™ç™½ï¼‰ ========= */
function waitForImages(root){
  const imgs = Array.from(root.querySelectorAll("img"));
  return Promise.all(imgs.map(img => {
    if(img.complete && img.naturalWidth > 0) return Promise.resolve();
    return new Promise(res => {
      img.addEventListener("load", res, { once:true });
      img.addEventListener("error", res, { once:true });
    });
  }));
}

async function downloadResult(){
  const btn = $("downloadBtn");
  btn.disabled = true;
  const oldText = btn.textContent;
  btn.textContent = "ä¸‹è¼‰ä¸­â€¦";

  try{
    const shareCard = $("shareCard");
    shareCard.innerHTML = "";

    const clone = $("resultInner").cloneNode(true);

    const br = clone.querySelector("#btnRow");
    if(br) br.remove();

    const liveCanvas = $("radar");
    const canvasImg = document.createElement("img");
    canvasImg.src = liveCanvas.toDataURL("image/png");
    canvasImg.style.width = "100%";
    canvasImg.style.maxWidth = "520px";
    canvasImg.style.display = "block";
    canvasImg.style.margin = "0 auto";

    const cloneCanvas = clone.querySelector("#radar");
    if(cloneCanvas && cloneCanvas.parentNode){
      cloneCanvas.parentNode.replaceChild(canvasImg, cloneCanvas);
    }

    clone.querySelectorAll("img").forEach(img=>{
      img.setAttribute("crossorigin","anonymous");
      img.setAttribute("loading","eager");
      img.setAttribute("decoding","sync");
      img.referrerPolicy = "no-referrer";
    });

    shareCard.appendChild(clone);

    const foot = document.createElement("div");
    foot.id = "shareFooter";
    foot.textContent = "å¤©è³¦èƒ½é‡æ¸¬é©—ï½œçµæœåˆ†äº«å¡";
    shareCard.appendChild(foot);

    await waitForImages(shareCard);

    const canvas = await html2canvas($("shareStage"), {
      scale: 2,
      useCORS: true,
      allowTaint: false,
      backgroundColor: "#f6f7fb",
      windowWidth: 1080,
    });

    const a = document.createElement("a");
    const stamp = new Date().toISOString().slice(0,10);
    a.download = `å¤©è³¦èƒ½é‡æ¸¬é©—_çµæœ_${stamp}.png`;
    a.href = canvas.toDataURL("image/png");
    a.click();

  }catch(err){
    console.error(err);
    alert("ä¸‹è¼‰å¤±æ•—ï¼šå¾ˆå¯èƒ½æ˜¯åœ–ç‰‡ä¾†æºä¸æ”¯æ´è·¨ç¶²åŸŸï¼ˆCORSï¼‰ï¼Œæ‰€ä»¥è¢«ç€è¦½å™¨æ“‹ä½äº†ã€‚ä½ æŠŠåœ–ç‰‡æ”¾åˆ°åŒç¶²åŸŸï¼ˆæˆ–æ›æ”¯æ´ CORS çš„åœ–åºŠï¼‰å°±æœƒ 100% æ­£å¸¸ï½æˆ‘ä¹Ÿå¯ä»¥å¹«ä½ ä¸€èµ·èª¿æ•´ã€‚");
  }finally{
    btn.disabled = false;
    btn.textContent = oldText;
  }
}

function showResult(){
  if(answers.some(v=>!v)){
    alert("é‚„æœ‰é¡Œç›®æ²’ä½œç­”å–”ï½");
    return;
  }

  const res = analyzeTalent(answers);
  const p = res.percentages;
  const type8 = res.type8;
  const main = res.mainEnergy;
  const role = res.final_trait;

  $("quizPage").style.display="none";
  $("resultPage").style.display="flex";

  $("energyLine").innerHTML =
    `<div class="label">æˆ‘çš„å¤©è³¦èƒ½é‡</div>` +
    `<div class="energyVals">` +
      `<span>ç™¼é›»æ©Ÿ ï¼š${p.D}%</span>` +
      `<span>ç«ç„° ï¼š${p.B}%</span>` +
      `<span>ç¯€å¥ ï¼š${p.T}%</span>` +
      `<span>é‹¼éµ ï¼š${p.S}%</span>` +
    `</div>`;

  const mainName = main === "D" ? "ç™¼é›»æ©Ÿ" : main === "B" ? "ç«ç„°" : main === "T" ? "ç¯€å¥" : "é‹¼éµ";
  $("summaryLine").textContent =
    `ä½ çš„ä¸»èƒ½é‡æ˜¯ã€${mainName}ã€‘\n`+
    `ä½ å¤©è³¦é †æµè§’è‰²æ˜¯ã€${role}ã€‘`;

  const block = TRAIT_BLOCKS[role] || { title:`${role}`, oneLine:"", adv:"", blind:"", wealth:"" };
  $("finalTraitTitle").textContent = block.title || role;
  $("traitOneLine").textContent = block.oneLine || "";
  $("advText").textContent = block.adv || "";
  $("blindText").textContent = block.blind || "";
  $("wealthText").textContent = block.wealth || "";

  // âœ… é€™è¡Œæ”¹äº†ï¼šæŠŠ main èƒ½é‡å¸¶é€²å»æ±ºå®šé¡è‰²
  drawRadar(type8, main);

  const maxVal = Math.max(p.D, p.B, p.T, p.S);
  const topKeys = ["D","B","T","S"].filter(k => p[k] === maxVal).slice(0,2);
  const wrap = $("traitImgs");
  wrap.className = topKeys.length === 1 ? "one" : "two";
  wrap.innerHTML = topKeys.map(k =>
    `<img crossorigin="anonymous" referrerpolicy="no-referrer" loading="eager" decoding="sync" src="${ENERGY_IMAGE[k] || ""}" alt="${k}">`
  ).join("");
}

window.addEventListener("DOMContentLoaded", ()=>{
  $("startBtn").addEventListener("click", startQuiz);
  $("prevBtn").addEventListener("click", prevQ);
  $("nextBtn").addEventListener("click", nextQ);
  $("againBtn").addEventListener("click", restartQuiz);
  $("downloadBtn").addEventListener("click", downloadResult);
});
</script>
</body>
</html>




