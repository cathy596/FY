<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¤©è³¦èƒ½é‡æ¸¬é©—ï½œæ­£å¼ç‰ˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;900&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box}

    /* âœ… èƒŒæ™¯åœ–æ”¾åˆ° htmlï¼Œè®“ body::before æ·¡åŒ–é®ç½©èƒ½è“‹åœ¨èƒŒæ™¯ä¸Š */
    html{
      height:100%;
      background:url("https://i.ibb.co/LMwXqHx/23-0.png") center/cover no-repeat fixed;
    }

    body{
      margin:0;
      min-height:100%;
      font-family:"Noto Sans TC",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:transparent;
      color:#111827;
      position:relative;
    }

    /* âœ… èƒŒæ™¯æ·¡åŒ–é®ç½©ï¼ˆæ•¸å­—è¶Šå¤§è¶Šæ·¡ï¼‰ */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:rgba(255,255,255,.45);
      pointer-events:none;
      z-index:-1;
    }

    .section{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      text-align:center;
      position:relative;
      z-index:1;
    }
    button{cursor:pointer}

    /* é–‹å§‹é  */
    #startPage h1{
      color:#c0822a;
      font-size:clamp(28px,5vw,40px);
      margin-bottom:12px;
    }
    #startPage p{
      font-size:16px;
      margin-bottom:20px;
      color:#374151;
      line-height:1.7;
    }

    /* âœ… é–‹å§‹ä½œç­”æŒ‰éˆ•ï¼šæ›´æ·±é§è‰² */
    #startPage button{
      padding:14px 28px;
      font-size:18px;
      font-weight:700;
      border:none;
      border-radius:14px;
      background:#8A571A; /* æ·±ä¸€é» */
      color:#fff;
      box-shadow:0 8px 24px rgba(138,87,26,.35);
    }
    #startPage button:hover{filter:brightness(1.05)}

    /* é¡Œç›®é  */
    #quizPage{display:none;text-align:left;}
    #quizInner{
      max-width:720px;
      width:100%;
      margin:0 auto;
      padding:20px 18px;
      border-radius:20px;
      background:rgba(255,255,255,.92);
      box-shadow:0 14px 40px rgba(0,0,0,.12);
    }
    #progress{font-size:14px;color:#6b7280;margin-bottom:8px;}
    #questionTitle{font-size:20px;font-weight:700;margin-bottom:14px;line-height:1.6;}
    .option{
      padding:12px 10px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      font-size:16px;
      margin-top:8px;
      background:#fff;
      transition:.18s;
      user-select:none;
    }
    .option:hover{
      border-color:#6c4af2;
      color:#6c4af2;
      box-shadow:0 6px 14px rgba(108,74,242,.18);
      transform:translateY(-1px);
    }
    .option.selected{
      border-color:#6c4af2;
      color:#6c4af2;
      background:rgba(108,74,242,.10);
      box-shadow:0 10px 20px rgba(108,74,242,.18);
      transform:translateY(-1px);
    }
    #navRow{
      margin-top:18px;
      display:flex;
      justify-content:space-between;
      gap:8px;
    }
    #navRow button{
      flex:1;
      padding:10px 0;
      border-radius:10px;
      border:none;
      font-size:15px;
      font-weight:600;
    }
    #prevBtn{background:#f3f4f6;color:#111827;}
    #prevBtn:disabled{opacity:.4;cursor:not-allowed;}
    #nextBtn{
      background:#6c4af2;
      color:#fff;
      box-shadow:0 6px 18px rgba(108,74,242,.35);
    }

    /* çµæœé  */
    #resultPage{display:none;text-align:left;}
    #resultInner{
      max-width:980px;
      width:100%;
      margin:0 auto;
      padding:22px 18px 26px;
      border-radius:22px;
      background:rgba(255,255,255,.95);
      box-shadow:0 16px 45px rgba(0,0,0,.14);
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    /* â‘  ç¬¬ä¸€è¡Œï¼šèƒ½é‡åŒä¸€è¡Œ */
    #energyLine{
      display:flex;
      flex-wrap:wrap;
      gap:10px 14px;
      align-items:center;
      font-size:15px;
      line-height:1.6;
      color:#111827;
      font-weight:700;
    }
    #energyLine .label{
      color:#111827;
      font-weight:900;
      margin-right:2px;
    }

    /* â‘¡ é›·é”åœ– + è§£æåœ– */
    #vizRow{
      display:grid;
      gap:12px;
      align-items:start;
    }
    @media(min-width:820px){
      #vizRow{grid-template-columns:1fr 1fr;}
    }
    #radar{
      width:100%;
      max-width:420px;
      aspect-ratio:1/1;
      height:auto;
      display:block;
      margin:0 auto;
    }

    /* âœ… è§£æåœ–ï¼šåªé¡¯ç¤ºæœ€é«˜æ¯”ä¾‹ï¼ˆä¸¦åˆ—é¡¯ç¤ºå…©å¼µï¼‰ */
    #traitImgs{
      width:100%;
      max-width:420px;
      margin:0 auto;
      display:grid;
      gap:10px;
    }
    #traitImgs.one{grid-template-columns:1fr;}
    #traitImgs.two{grid-template-columns:1fr 1fr;}
    @media(max-width:520px){
      #traitImgs.two{grid-template-columns:1fr;}
    }
    #traitImgs img{
      width:100%;
      border-radius:18px;
      display:block;
      object-fit:cover;
    }

    /* â‘¢ ä¸»èƒ½é‡/è§’è‰²å°æ®µ */
    #summaryLine{
      white-space:pre-wrap;
      font-size:15px;
      line-height:1.7;
      color:#374151;
      margin-top:2px;
      font-weight:700;
    }

    /* â‘£ è§£æå¡ */
    #finalTraitTitle{
      font-size:22px;
      font-weight:900; /* âœ… åªæœ‰æ¨™é¡Œç²—é«” */
      color:#111827;
      margin:8px 0 0;
    }
    /* âœ… é™¤äº†æ¨™é¡Œï¼Œå…¶ä»–ä¸è¦ç²—é«” */
    #traitOneLine{
      font-size:15px;
      color:#374151;
      margin:2px 0 8px;
      font-weight:400;
    }
    #traitCard{
      border:1px solid #e5e7eb;
      border-radius:16px;
      padding:14px 14px 12px;
      background:#fff;
    }
    .kTitle{
      color:#c0822a;
      font-weight:400;
      margin:10px 0 6px;
      font-size:14px;
      letter-spacing:.5px;
    }
    .kBody{
      white-space:pre-wrap;
      font-size:15px;
      line-height:1.75;
      color:#111827;
      margin:0;
      font-weight:400;
    }

    #againBtn{
      margin-top:6px;
      padding:10px 16px;
      border:none;
      border-radius:999px;
      background:#6c4af2;
      color:#fff;
      font-weight:800;
      font-size:15px;
      cursor:pointer;
      align-self:flex-start;
    }
  </style>
</head>

<body>

  <!-- é–‹å§‹é  -->
  <section id="startPage" class="section">
    <div>
      <h1>å®Œæˆ 25 é¡Œ<br>æ¸¬å‡ºä½ çš„å¤©è³¦èƒ½é‡</h1>
      <p>ç”¨ 8 å¤§è·æ¶¯ç‰¹è³ªï¼Œå¹«ä½ çœ‹è¦‹æœ€é©åˆä½ çš„è³ºéŒ¢æ–¹å¼ã€‚<br>å¤§æ¦‚ 5 åˆ†é˜ï¼Œå°±èƒ½æŠŠä½ çš„å¤©è³¦åœ°åœ–æ‰“é–‹ã€‚</p>
      <button id="startBtn">é–‹å§‹ä½œç­”</button>
    </div>
  </section>

  <!-- é¡Œç›®é  -->
  <section id="quizPage" class="section">
    <div id="quizInner">
      <div id="progress"></div>
      <div id="questionTitle"></div>
      <div id="options"></div>
      <div id="navRow">
        <button id="prevBtn">â¬… ä¸Šä¸€é¡Œ</button>
        <button id="nextBtn">ä¸‹ä¸€é¡Œ âœ</button>
      </div>
    </div>
  </section>

  <!-- çµæœé  -->
  <section id="resultPage" class="section">
    <div id="resultInner">

      <!-- â‘  èƒ½é‡ç¬¬ä¸€è¡Œï¼ˆåŒä¸€è¡Œï¼‰ -->
      <div id="energyLine"></div>

      <!-- â‘¡ é›·é”åœ– + è§£æåœ– -->
      <div id="vizRow">
        <canvas id="radar"></canvas>
        <div id="traitImgs"></div>
      </div>

      <!-- â‘¢ ä¸»èƒ½é‡/è§’è‰² -->
      <div id="summaryLine"></div>

      <!-- â‘£ è§’è‰²è§£æ -->
      <div id="traitCard">
        <div id="finalTraitTitle"></div>
        <div id="traitOneLine"></div>

        <div class="kTitle">ã€å¤©ç”Ÿå„ªå‹¢ã€‘</div>
        <p class="kBody" id="advText"></p>

        <div class="kTitle">ã€å®¹æ˜“å¡é—œçš„åœ°æ–¹ã€‘</div>
        <p class="kBody" id="blindText"></p>

        <div class="kTitle">ã€è‡´å¯Œé—œéµã€‘</div>
        <p class="kBody" id="wealthText"></p>
      </div>

      <button id="againBtn">å†æ¸¬ä¸€æ¬¡</button>
    </div>
  </section>

<script>
/* ========= é¡Œç›®ï¼ˆ25 é¡Œï¼‰ ========= */
const QUESTIONS = [
  { q:"1. å¹³å¸¸åšäº‹æ™‚ï¼Œä½ æœ€å¸¸è¢«æ€éº¼å½¢å®¹ï¼Ÿ", a:["é»å­å¾ˆå¤šã€æƒ³æ³•è·³å¾ˆå¿«","è·Ÿä½ ç›¸è™•å¾ˆèˆ’æœ","åšäº‹æœƒå…ˆæƒ³é¢¨éšª","æ±è¥¿æ•´ç†å¾—å¾ˆå®Œæ•´"] },
  { q:"2. ä½ æ¯”è¼ƒå–œæ­¡åˆ¥äººæ€éº¼å½¢å®¹ä½ ï¼Ÿ", a:["æº«å’Œå¥½ç›¸è™•","èªªåˆ°åšåˆ°","æ±ºå®šäº‹æƒ…å¾ˆå¿«","è®“äººæ„Ÿè¦ºæœ‰èƒ½é‡"] },
  { q:"3. å“ªä¸€ç¨®æƒ…æ³æœ€è®“ä½ æœ‰æˆå°±æ„Ÿï¼Ÿ", a:["å…¨å±€åœ¨ä½ æŒæ¡ä¸­","è…¦ä¸­æƒ³æ³•è¢«å¯¦ç¾","è¢«å¤§å®¶è‚¯å®šã€çœ‹è¦‹","æŠ“åˆ°æ™‚æ©Ÿé †å‹¢è€Œç‚º"] },
  { q:"4. åˆä½œæ™‚ï¼Œä½ è‡ªç„¶æœƒåœ¨å“ªå€‹ä½ç½®ï¼Ÿ", a:["ä¸Ÿæƒ³æ³•ã€å®šæ–¹å‘","å°å¤–æºé€šã€ä¸²äºº","æ’æ™‚ç¨‹ã€æ§é€²åº¦","å»ºæµç¨‹ã€é¡§å“è³ª"] },
  { q:"5. åœ¨ä¸€ç¾¤äººè£¡ï¼Œä½ é€šå¸¸æ˜¯ï¼Ÿ", a:["æƒ³åšä»€éº¼å°±åšä»€éº¼","å¸¶å‹•æ°£æ°›çš„é‚£å€‹","è§€å¯Ÿå¾Œæ‰è¡Œå‹•","è©±ä¸å¤šä½†å¾ˆç©©"] },
  { q:"6. å£“åŠ›ä¾†æ™‚ï¼Œä½ æœ€å¸¸ä¾é å“ªä¸€ç¨®ï¼Ÿ", a:["é åŠªåŠ›ç¡¬æ’","é éˆæ„Ÿè§£æ±º","é äººå¹«å¿™","é æ•ˆç‡æµç¨‹"] },
  { q:"7. å“ªä¸€å¥æ¯”è¼ƒåƒä½ å…§å¿ƒçš„ç‹€æ…‹ï¼Ÿ", a:["æˆ‘ç¿’æ…£è‡ªå·±æƒ³æ¸…æ¥š","æˆ‘éœ€è¦æœ‰äººäº’å‹•","æˆ‘å¸¸æƒ³å¤ªä¹…","æˆ‘å—ä¸äº†æ‹–"] },
  { q:"8. é‡åˆ°é—œéµé¸æ“‡æ™‚ï¼Œä½ é€šå¸¸ï¼Ÿ", a:["è½è½åˆ¥äººç¶“é©—","çœ‹å¤§å®¶æ€éº¼é¸","åˆ—æ¸…æ¥šåˆ©å¼Š","æ„Ÿè¦ºå°å°±è¡"] },
  { q:"9. ä½ æœ€æ€•è¢«è²¼ä¸Šå“ªå€‹æ¨™ç±¤ï¼Ÿ", a:["çœ‹èµ·ä¾†å¾ˆæ··","ç„¡èŠæ²’ç‰¹è‰²","å¥½åƒæ²’æœ‹å‹","æ€è€ƒå¾ˆäº‚"] },
  { q:"10. å“ªç¨®å·¥ä½œå…§å®¹ä½ æ¯”è¼ƒæœ‰ç•«é¢ï¼Ÿ", a:["è²·ä½è³£é«˜ã€è«‡æ¢ä»¶","ç®¡ç†åˆ¶åº¦ã€æµç¨‹","å¿«é€Ÿè©¦éŒ¯ã€æ“´å¼µ","å’Œäººäº’å‹•ã€åˆä½œ"] },
  { q:"11. å¦‚æœå¯ä»¥é¸ï¼Œä½ æœ€æƒ³é¿é–‹å“ªç¨®äº‹ï¼Ÿ", a:["æƒ³æ–°ç­–ç•¥","åˆ†å·¥èˆ‡æ¶æ§‹","æµç¨‹èˆ‡ç³»çµ±","ä¸€ç›´å°äºº"] },
  { q:"12. åœ˜éšŠè£¡ï¼Œä½ å¸¸è¢«æœŸå¾…åšä»€éº¼ï¼Ÿ", a:["æ‰¾å•é¡Œã€æŒ‘æ¯›ç—…","ææ–°æ–¹å‘","å°å¤–é€£çµè³‡æº","æŠŠäº‹åšå®Œ"] },
  { q:"13. å“ªä¸€ä»¶äº‹æœ€å®¹æ˜“è®“ä½ å¡é—œï¼Ÿ", a:["ä¸»å‹•ç¶“ç‡Ÿé—œä¿‚","æ¯”åƒ¹ã€ç®— CP","æ†‘ç©ºæƒ³é»å­","æŒ–ç´°ç¯€éŒ¯èª¤"] },
  { q:"14. ä½ æœ€æœ‰è‡ªä¿¡çš„èƒ½åŠ›æ˜¯ï¼Ÿ", a:["æƒ³å‡ºæ²’äººæƒ³éçš„é»","æŠŠäººæ”¾åœ¨å°çš„ä½ç½®","ç®—å‡ºæœ€åˆ’ç®—æ–¹æ¡ˆ","æŠŠäº‹æƒ…åšåˆ°æ¨™æº–"] },
  { q:"15. å“ªç¨®ç‹€æ³ä½ æœƒæœ€å…§è€—ï¼Ÿ", a:["äººéš›æ°£æ°›å¾ˆå·®","æ²’è¦å‰‡ã€æ²’æ­¥é©Ÿ","é‚è¼¯å‰å¾Œä¸é€š","ä¸€ç›´é‡è¤‡"] },
  { q:"16. ä½ ç‰¹åˆ¥å—ä¸äº†å“ªä¸€ç¨®äººï¼Ÿ", a:["ä¸å®ˆç•Œç·š","ä¸€æˆä¸è®Š","æ­»ä¸è®Šé€š","åšäº‹å¾ˆäº‚"] },
  { q:"17. åˆ¥äººæœ€å¸¸ç¨±è®šä½ ï¼Ÿ", a:["å¾ˆæœƒæ¨ã€å¾ˆæœƒèªª","å¾ˆæœƒè«‡åˆ¤","çœ‹å•é¡Œå¾ˆæº–","æƒ³æ³•å¾ˆç‰¹åˆ¥"] },
  { q:"18. å“ªä¸€ä»¶äº‹ä½ æœ€æ²’æŠŠæ¡ï¼Ÿ", a:["æŠŠæµç¨‹è®Šæ›´å¥½","åˆ¤æ–·è¶¨å‹¢","æƒ³æ–°ç©æ³•","é•·æ™‚é–“äº’å‹•"] },
  { q:"19. ä»€éº¼æ™‚å€™ä½ æœƒæœ€é–‹å¿ƒï¼Ÿ", a:["å‰µæ„è¢«æ¡ç”¨","èªè­˜å°çš„äºº","æ’¿åˆ°å¥½åº·","ç³»çµ±è·‘å¾—å¾ˆé †"] },
  { q:"20. å“ªä¸€ä»¶äº‹æœ€è®“ä½ ç…©èºï¼Ÿ", a:["è¦å‰‡è¢«äº‚ç ´","ä¸€ç›´ç­‰æ²’é€²åº¦","äººéš›å¤±æº«","ä¸çŸ¥é“æ€éº¼é…åˆ"] },
  { q:"21. å·¥ä½œæ™‚ï¼Œä½ æ¯”è¼ƒåƒå“ªä¸€å‹ï¼Ÿ", a:["ç©©ç©©æŠŠé—œ","æ¢ç†æ¸…æ¥š","é»å­å‹","å¤–æ”¾å‹"] },
  { q:"22. å“ªå€‹å½¢å®¹ä½ æœƒè¦ºå¾—æ€ªæ€ªçš„ï¼Ÿ", a:["å¾ˆç©©","å¾ˆæœ‰æ¢ç†","å¾ˆæœ‰å‰µæ„","å¾ˆå¤–å‘"] },
  { q:"23. ä½ è¦ºå¾—è‡ªå·±åšä»€éº¼æœ€ä¸è²»åŠ›ï¼Ÿ", a:["å’Œäººå»ºç«‹é€£çµ","çœ‹å‡ºæ©Ÿæœƒé»","å„ªåŒ–æµç¨‹","ç™¼æƒ³æ–°æ–¹å‘"] },
  { q:"24. å¿«æ’ä¸ä½æ™‚ï¼Œä½ æœƒé ä»€éº¼ï¼Ÿ", a:["é‚è¼¯èˆ‡åˆ¤æ–·","å¤©è³¦ç›´è¦º","æ‰¾äººå¹«å¿™","ç¹¼çºŒç¡¬æ’"] },
  { q:"25. äº‹æƒ…å®Œæˆå¾Œï¼Œä½ ç¬¬ä¸€å€‹åæ‡‰æ˜¯ï¼Ÿ", a:["å¥½å¥½æ…¶ç¥ä¸€ä¸‹","æ„Ÿè¬èº«é‚Šçš„äºº","æ”¶å°¾æ•´ç†","æƒ³ä¸‹ä¸€æ­¥"] },
];

/* ========= DBTS è¨ˆåˆ†ï¼ˆæ²¿ç”¨ï¼‰ ========= */
const SCORE_MAP = [
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{T:+1}, B:{S:+1}, C:{D:+1}, D:{B:+1} },
  { A:{S:+1}, B:{D:+1}, C:{B:+1}, D:{T:+1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{T:+1}, B:{D:+1}, C:{B:+1}, D:{S:+1} },
  { A:{S:+1}, B:{B:+1}, C:{T:+1}, D:{D:+1} },
  { A:{T:+1}, B:{B:+1}, C:{S:+1}, D:{D:+1} },
  { A:{T:+1}, B:{D:+1}, C:{B:+1}, D:{S:+1} },
  { A:{T:+1}, B:{S:+1}, C:{D:+1}, D:{B:+1} },
  { A:{D:-1}, B:{T:-1}, C:{S:-1}, D:{B:-1} },
  { A:{S:+1}, B:{D:+1}, C:{B:+1}, D:{T:+1} },
  { A:{B:-1}, B:{T:-1}, C:{D:-1}, D:{S:-1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{B:+1}, B:{T:+1}, C:{S:+1}, D:{D:+1} },
  { A:{S:+1}, B:{B:+1}, C:{D:+1}, D:{T:+1} },
  { A:{B:+1}, B:{T:+1}, C:{S:+1}, D:{D:+1} },
  { A:{B:+1}, B:{D:+1}, C:{T:+1}, D:{S:+1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
  { A:{S:+1}, B:{D:+1}, C:{B:+1}, D:{T:+1} },
  { A:{S:+1}, B:{T:+1}, C:{D:+1}, D:{B:+1} },
  { A:{S:-1}, B:{T:-1}, C:{D:-1}, D:{B:-1} },
  { A:{B:+1}, B:{T:+1}, C:{S:+1}, D:{D:+1} },
  { A:{S:+1}, B:{D:+1}, C:{B:+1}, D:{T:+1} },
  { A:{D:+1}, B:{B:+1}, C:{T:+1}, D:{S:+1} },
];

function applyDelta(scores, delta){
  for(const k in delta) scores[k] = (scores[k] || 0) + delta[k];
}

/* âœ… ç™¾åˆ†æ¯”ï¼šæŠŠ raw è½‰æˆã€Œæ¬Šé‡ã€å†æ›ç®— 0~100ï¼ˆé¿å…è² å€¼æŠŠæ¯”ä¾‹ææ€ªï¼‰ */
function toPercentagesFromRaw(raw){
  const w = {
    D: Math.abs(raw.D || 0),
    B: Math.abs(raw.B || 0),
    T: Math.abs(raw.T || 0),
    S: Math.abs(raw.S || 0),
  };
  let sum = w.D + w.B + w.T + w.S;

  // å…¨ 0 çš„ä¿åº•ï¼ˆæ¥µå°‘ç™¼ç”Ÿï¼‰
  if(!sum){
    return { D:25, B:25, T:25, S:25 };
  }

  // å…ˆå››æ¨äº”å…¥
  let p = {
    D: Math.round(w.D / sum * 100),
    B: Math.round(w.B / sum * 100),
    T: Math.round(w.T / sum * 100),
    S: Math.round(w.S / sum * 100),
  };

  // âœ… è®“ç¸½å’Œç²¾æº– = 100ï¼ˆæŠŠå·®é¡è£œåˆ°æœ€å¤§æ¬Šé‡é‚£ä¸€é …ï¼‰
  const total = p.D + p.B + p.T + p.S;
  const diff = 100 - total;
  if(diff !== 0){
    let best = "D";
    let bestV = w.D;
    for(const k of ["B","T","S"]){
      if(w[k] > bestV){ bestV = w[k]; best = k; }
    }
    p[best] += diff;
  }

  // ä¿åº•ä¸å‡ºç•Œ
  for(const k of ["D","B","T","S"]){
    p[k] = Math.max(0, Math.min(100, p[k]));
  }
  return p;
}

/* âœ… å…«è§’è‰²è¨ˆç®—ï¼ˆä½ æŒ‡å®šï¼šé›™èƒ½é‡ï¼å…©èƒ½é‡åŠ èµ·ä¾†é™¤2ï¼‰ */
function mapDBTS_to_8types(percentages){
  const { D, B, T, S } = percentages;
  const avg = (a,b)=>Math.round((a+b)/2);
  return {
    æŠ€å¸«:   avg(S, D),
    å‰µä½œè€…: D,
    æ˜æ˜Ÿ:   avg(D, B),
    æ”¯æŒè€…: B,
    åª’åˆè€…: avg(B, T),
    å•†äºº:   T,
    ç©è“„è€…: avg(T, S),
    åœ°ä¸»:   S,
  };
}

/* âœ… è§’è‰² = 8 é¡åˆ†æ•¸æœ€é«˜ï¼ˆåŒåˆ†ç…§é †åºæŒ‘ç¬¬ä¸€å€‹ï¼‰ */
const ROLE_ORDER_8 = ["æŠ€å¸«","å‰µä½œè€…","æ˜æ˜Ÿ","æ”¯æŒè€…","åª’åˆè€…","å•†äºº","ç©è“„è€…","åœ°ä¸»"];
function pickRoleBy8Types(type8){
  let best = ROLE_ORDER_8[0];
  let bestV = type8[best] ?? -Infinity;
  for(const k of ROLE_ORDER_8){
    const v = type8[k] ?? -Infinity;
    if(v > bestV){
      bestV = v;
      best = k;
    }
  }
  return best;
}

/* âœ… ä¸»èƒ½é‡ = å››å¤§ç™¾åˆ†æ¯”æœ€é«˜ */
function pickMainEnergy(percentages){
  let best = "D";
  let bestV = percentages.D;
  for(const k of ["B","T","S"]){
    if(percentages[k] > bestV){ bestV = percentages[k]; best = k; }
  }
  return best;
}

/* è§£æåœ–ï¼ˆD/B/T/Sï¼‰ */
const ENERGY_IMAGE = {
  B:'https://i.ibb.co/jZQjqmNg/1-0.jpg',
  D:'https://i.ibb.co/0Ry8FxZ1/2-0.jpg',
  T:'https://i.ibb.co/S40Nh5dw/3-0.jpg',
  S:'https://i.ibb.co/Hfjb0rhc/4-0.jpg'
};

/* è§’è‰²åˆ†æ®µè§£æï¼ˆ8 å€‹éƒ½é½Šï¼‰ */
const TRAIT_BLOCKS = {
  "æŠ€å¸«":   { title:"ğŸ› ï¸ æŠ€å¸«",   oneLine:"ä½ æ˜¯è®“äº‹æƒ…è®Šæ›´å¥½çš„äººã€‚", adv:"èƒ½è¦ªè‡ªä¸‹å ´ã€å„ªåŒ–æµç¨‹ï¼ŒæŠŠæ··äº‚è®Šæˆç³»çµ±ã€‚", blind:"å®¹æ˜“ä»¥ç‚ºè‡ªå·±è¦å¾ 0 å‰µé€ ï¼Œå…¶å¯¦ä½ æ›´æ“…é•·ã€Œå„ªåŒ–ã€ã€‚", wealth:"ğŸ‘‰ æ‰“é€ æ›´å¥½çš„ç³»çµ±ï¼Œè€Œä¸æ˜¯ä¸€ç›´é‡ä¾†ã€‚" },
  "å‰µä½œè€…": { title:"ğŸŒ± å‰µä½œè€…", oneLine:"ä½ æ˜¯é»å­ä¸€ä¾†å°±æƒ³ç«‹åˆ»é–‹å·¥çš„äººã€‚", adv:"é»å­å¤šã€è¡Œå‹•å¿«ï¼Œæ•¢å¾ 0 åˆ° 1 é–‹æ–°å±€ã€‚", blind:"è·‘å¤ªå¿«ã€ä»€éº¼éƒ½æƒ³è‡ªå·±ä¾†ï¼Œæœ€å¾Œåè€Œç´¯çˆ†ã€‚", wealth:"ğŸ‘‰ å»ºä¸€å¥—æœƒè‡ªå·±é•·å¤§çš„å•†æ¥­ç³»çµ±ï¼Œä¸è¦æ°¸é é ä½ ç¡¬æ’ã€‚" },
  "æ˜æ˜Ÿ":   { title:"âœ¨ æ˜æ˜Ÿ",   oneLine:"ä½ æœ¬äººï¼Œå°±æ˜¯äº®é»ã€‚", adv:"é­…åŠ›å¼·ã€æœ‰è¾¨è­˜åº¦ï¼Œåšè‡ªå·±å°±èƒ½å¸å¼•æ©Ÿæœƒã€‚", blind:"å¤ªæƒ³è¦ªåŠ›è¦ªç‚ºï¼Œå¿½ç•¥ã€Œä½ çš„åƒ¹å€¼å°±åœ¨ä½ èº«ä¸Šã€ã€‚", wealth:"ğŸ‘‰ æŠŠå“ç‰Œåšå°–ï¼ŒæŠŠåŸ·è¡Œäº¤çµ¦åˆä½œå¤¥ä¼´ã€‚" },
  "æ”¯æŒè€…": { title:"ğŸ¤ æ”¯æŒè€…", oneLine:"ä½ æ˜¯åœ˜éšŠè£¡çš„é»è‘—åŠ‘ã€‚", adv:"å¾ˆæœƒç…§é¡§äººã€å‡èšæ°›åœï¼Œèƒ½æŠŠåœ˜éšŠæ’èµ·ä¾†ã€‚", blind:"å¤ªåœ¨ä¹äººæƒ…ï¼Œç¯€å¥å®¹æ˜“è¢«å¸¶èµ°ã€‚", wealth:"ğŸ‘‰ é¸å°åœ˜éšŠï¼Œè®“åˆä½œæ”¾å¤§ä½ çš„å½±éŸ¿åŠ›ã€‚" },
  "åª’åˆè€…": { title:"ğŸ”— åª’åˆè€…", oneLine:"ä½ å¾ˆæœƒæŠŠäººæ”¾åœ¨å°çš„ä½ç½®ã€‚", adv:"æ‡‚å¾—é€£çµã€æ‡‚å¾—äº¤æ˜“ï¼Œèƒ½ç‰½èµ·é—œéµåˆä½œã€‚", blind:"å¿™è‘—å¹«å¤§å®¶æ­æ©‹ï¼Œå¿˜äº†è‡ªå·±çš„åˆ©æ½¤èˆ‡ä½ç½®ã€‚", wealth:"ğŸ‘‰ å“è³ªï¼‹ä¿¡ä»»æ˜¯ä½ çš„åº•æ°£ï¼Œé¸å°å•†å“ä½ å°±æœƒå¾ˆå¼·ã€‚" },
  "å•†äºº":   { title:"ğŸ’¼ å•†äºº",   oneLine:"ä½ å°æ™‚æ©Ÿç‰¹åˆ¥æ•æ„Ÿã€‚", adv:"è§€å¯ŸåŠ›å¼·ã€åæ‡‰å¿«ï¼Œå®¹æ˜“åœ¨è¡Œå‹•ä¸­æ‰¾åˆ°æ©Ÿæœƒã€‚", blind:"å¤ªå°ˆæ³¨çœ¼å‰ï¼Œå¯èƒ½å¿½ç•¥é•·æœŸåƒ¹å€¼ã€‚", wealth:"ğŸ‘‰ æŒæ¡ç¯€å¥ã€çœ‹æ‡‚å¾ªç’°ï¼Œè®“ç²åˆ©æ›´ç©©ã€‚" },
  "ç©è“„è€…": { title:"ğŸª™ ç©è“„è€…", oneLine:"ä½ èµ°å¾—æ…¢ï¼Œä½†èµ°å¾—å¾ˆç©©ã€‚", adv:"è¬¹æ…å¯é ï¼Œæ“…é•·ç´¯ç©è³‡ç”¢èˆ‡å°ˆæ¥­ã€‚", blind:"æƒ³æº–å‚™åˆ°å®Œç¾æ‰è¡Œå‹•ï¼Œå®¹æ˜“æ‹–å»¶ã€‚", wealth:"ğŸ‘‰ è²·é€²ä¸¦æŒæœ‰æœƒé•·å¤§çš„è³‡ç”¢ï¼Œæ™‚é–“ç«™åœ¨ä½ é€™é‚Šã€‚" },
  "åœ°ä¸»":   { title:"ğŸ  åœ°ä¸»",   oneLine:"ä½ æ˜¯æŒæ§å¾Œç«¯çš„é—œéµè§’è‰²ã€‚", adv:"é‡ç´°ç¯€ã€é‡æµç¨‹ï¼Œèƒ½è®“ç³»çµ±ç©©å®šé‹ä½œã€‚", blind:"ä¸æ„›ç†±é¬§ç¤¾äº¤ï¼Œå®¹æ˜“é é›¢å‰ç·šæ©Ÿæœƒã€‚", wealth:"ğŸ‘‰ å»ºç«‹ç©©å®šç¾é‡‘æµï¼Œè®“ä½ è¶Šä¾†è¶Šæœ‰åº•æ°£ã€‚" }
};

function analyzeTalent(answerArray){
  const raw = { D:0, B:0, T:0, S:0 };

  for(let i=0;i<QUESTIONS.length;i++){
    const v = answerArray[i];
    const letter = ["A","B","C","D"][v-1];
    applyDelta(raw, SCORE_MAP[i][letter]);
  }

  const percentages = toPercentagesFromRaw(raw);
  const type8 = mapDBTS_to_8types(percentages);
  const mainEnergy = pickMainEnergy(percentages);
  const final_trait = pickRoleBy8Types(type8);

  return { raw, percentages, type8, mainEnergy, final_trait };
}

/* ========= ä½œç­”æµç¨‹ ========= */
let currentIndex = 0;
const answers = new Array(QUESTIONS.length);
const $ = (id)=>document.getElementById(id);

function startQuiz(){
  $("startPage").style.display="none";
  $("quizPage").style.display="flex";
  renderQuestion();
}

function renderQuestion(){
  const q = QUESTIONS[currentIndex];
  const total = QUESTIONS.length;
  $("progress").innerText = `ç¬¬ ${currentIndex+1} / ${total} é¡Œ`;
  $("questionTitle").innerText = q.q;

  const selected = answers[currentIndex];
  $("options").innerHTML = q.a.map((txt,i)=>{
    const isSel = selected === (i+1);
    return `<div class="option ${isSel ? 'selected' : ''}" data-idx="${i}">${String.fromCharCode(65+i)}ï½œ${txt}</div>`;
  }).join("");

  $("options").querySelectorAll(".option").forEach(el=>{
    el.addEventListener("click", ()=> pickOption(parseInt(el.dataset.idx,10)));
  });

  $("prevBtn").disabled = currentIndex===0;
  $("nextBtn").innerText = currentIndex === total-1 ? "çœ‹çµæœ âœ" : "ä¸‹ä¸€é¡Œ âœ";
}

function pickOption(idx){
  answers[currentIndex] = idx+1;
  renderQuestion();

  if(currentIndex === QUESTIONS.length - 1) return;

  setTimeout(()=>{
    currentIndex++;
    renderQuestion();
    window.scrollTo(0,0);
  }, 120);
}

function prevQ(){
  if(currentIndex>0){
    currentIndex--;
    renderQuestion();
    window.scrollTo(0,0);
  }
}

function nextQ(){
  const a = answers[currentIndex];
  if(!a){ alert("é€™ä¸€é¡Œé‚„æ²’ä½œç­”å–”ï½"); return; }

  if(currentIndex < QUESTIONS.length-1){
    currentIndex++;
    renderQuestion();
    window.scrollTo(0,0);
  }else{
    showResult();
  }
}

/* âœ… å†æ¸¬ä¸€æ¬¡ï¼šå›åˆ°é–‹å§‹é  */
function restartQuiz(){
  for(let i=0;i<answers.length;i++) answers[i] = undefined;
  currentIndex = 0;

  $("resultPage").style.display = "none";
  $("quizPage").style.display   = "none";
  $("startPage").style.display  = "flex";

  window.scrollTo(0,0);
}

/* ========= é›·é”èƒŒæ™¯ ========= */
let radarBg = null;
(function preloadBg(){
  radarBg = new Image();
  radarBg.crossOrigin = "anonymous";
  radarBg.src = "https://i.ibb.co/8gPc8txW/result-bg.png";
})();

function resizeCanvasToDisplaySize(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  const size = Math.floor(Math.min(rect.width, rect.height)) || 420;
  const needW = Math.floor(size * dpr);
  const needH = Math.floor(size * dpr);
  if(canvas.width !== needW || canvas.height !== needH){
    canvas.width = needW;
    canvas.height = needH;
  }
  return { size, dpr };
}

/* ========= é›·é”åœ–ï¼ˆç¬¬ä¸€å±¤ 30%ï¼Œç¬¬äºŒå±¤ 70%ï¼‰ ========= */
function drawRadar(type8){
  const c = $("radar");
  const ctx = c.getContext("2d");
  const { size, dpr } = resizeCanvasToDisplaySize(c);

  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,c.width,c.height);
  ctx.scale(dpr, dpr);

  const S = size;
  const cX = S/2, cY = S/2;

  if (radarBg && radarBg.complete) ctx.drawImage(radarBg, 0, 0, S, S);
  else {
    ctx.fillStyle = "#fff";
    ctx.fillRect(0,0,S,S);
    if (radarBg) radarBg.onload = ()=>drawRadar(type8);
  }

  const labelPad = Math.max(90, Math.round(S * 0.22));
  const half = (S/2) - labelPad;
  const left = cX - half, right = cX + half;
  const top  = cY - half, bottom = cY + half;

  // è®“å…«é‚Šå½¢é ‚é»ç¢°åˆ°æ­£æ–¹å½¢é‚Šï¼ˆç”¨ cos(22.5Â°)ï¼‰
  const r = half / 0.9238795325;

  const drawSquare = (h)=>{
    ctx.beginPath();
    ctx.moveTo(cX - h, cY - h);
    ctx.lineTo(cX + h, cY - h);
    ctx.lineTo(cX + h, cY + h);
    ctx.lineTo(cX - h, cY + h);
    ctx.closePath();
    ctx.stroke();
  };
  const drawOct = (rr)=>{
    ctx.beginPath();
    for(let i=0;i<8;i++){
      const ang = (-90 + i*45) * Math.PI/180;
      const x = cX + rr*Math.cos(ang);
      const y = cY + rr*Math.sin(ang);
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath();
    ctx.stroke();
  };

  // å¤–æ­£æ–¹å½¢
  ctx.strokeStyle = "#cfcfcf";
  ctx.lineWidth = Math.max(1.5, S * 0.004);
  drawSquare(half);

  // è§’è½æ”¾å°„è™›ç·š
  ctx.save();
  ctx.setLineDash([S*0.01, S*0.015]);
  ctx.strokeStyle = "#d9d9d9";
  ctx.lineWidth = Math.max(1, S * 0.003);
  const corners = [[left,top],[right,top],[right,bottom],[left,bottom]];
  for(const [x,y] of corners){
    ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(cX,cY); ctx.stroke();
  }
  ctx.restore();

  // åå­—è™›ç·š
  ctx.save();
  ctx.setLineDash([S*0.008, S*0.016]);
  ctx.strokeStyle = "#d9d9d9";
  ctx.lineWidth = Math.max(1, S * 0.003);
  ctx.beginPath();
  ctx.moveTo(cX, top);    ctx.lineTo(cX, bottom);
  ctx.moveTo(left, cY);   ctx.lineTo(right, cY);
  ctx.stroke();
  ctx.restore();

  // âœ… å…«é‚Šå½¢æ ¼ç·šï¼š30% / 70%
  ctx.strokeStyle = "#d0d0d0";
  ctx.lineWidth = Math.max(1.5, S * 0.004);
  drawOct(r * 0.30);
  drawOct(r * 0.70);

  // å…«æ–¹å‘å°„ç·šï¼ˆåˆ°æ­£æ–¹å½¢é‚Šç•Œï¼‰
  ctx.beginPath();
  for (let i = 0; i < 8; i++) {
    const ang = (-90 + i * 45) * Math.PI / 180;
    const dx = Math.cos(ang);
    const dy = Math.sin(ang);
    const maxToSquare = half / Math.max(Math.abs(dx), Math.abs(dy));
    ctx.moveTo(cX, cY);
    ctx.lineTo(cX + maxToSquare * dx, cY + maxToSquare * dy);
  }
  ctx.strokeStyle = "#e0e0e0";
  ctx.lineWidth = Math.max(1, S * 0.003);
  ctx.stroke();

  // å¤–åœ label é»èˆ‡å­—
  const dotR = Math.max(5, Math.round(S * 0.015));
  const dotGap  = Math.max(16, Math.round(S * 0.04));
  const textGap = Math.max(18, Math.round(S * 0.05));
  const fontSize = Math.max(12, Math.round(S * 0.04));

  ctx.font = `600 ${fontSize}px 'Noto Sans TC'`;
  ctx.textBaseline = "middle";

  const P = {
    "æŠ€å¸«":   { dotX: left  - dotGap, dotY: top    - dotGap,  textX: left  - dotGap - textGap, textY: top    - dotGap - textGap, align:"right" },
    "å‰µä½œè€…": { dotX: cX,            dotY: top    - dotGap,  textX: cX,                     textY: top    - dotGap - textGap, align:"center" },
    "æ˜æ˜Ÿ":   { dotX: right + dotGap, dotY: top    - dotGap,  textX: right + dotGap + textGap, textY: top  - dotGap - textGap, align:"left" },
    "æ”¯æŒè€…": { dotX: right + dotGap, dotY: cY,              textX: right + dotGap + textGap, textY: cY,                      align:"left" },
    "åª’åˆè€…": { dotX: right + dotGap, dotY: bottom + dotGap, textX: right + dotGap + textGap, textY: bottom + dotGap + textGap, align:"left" },
    "å•†äºº":   { dotX: cX,            dotY: bottom + dotGap, textX: cX,                     textY: bottom + dotGap + textGap, align:"center" },
    "ç©è“„è€…": { dotX: left  - dotGap, dotY: bottom + dotGap, textX: left  - dotGap - textGap, textY: bottom + dotGap + textGap, align:"right" },
    "åœ°ä¸»":   { dotX: left  - dotGap, dotY: cY,              textX: left  - dotGap - textGap, textY: cY,                      align:"right" },
  };

  const labels = ["æŠ€å¸«","å‰µä½œè€…","æ˜æ˜Ÿ","æ”¯æŒè€…","åª’åˆè€…","å•†äºº","ç©è“„è€…","åœ°ä¸»"];
  for (const name of labels) {
    const pos = P[name];
    ctx.beginPath();
    ctx.fillStyle = "#f2c94c";
    ctx.arc(pos.dotX, pos.dotY, dotR, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#666";
    ctx.textAlign = pos.align;
    ctx.fillText(name, pos.textX, pos.textY);
  }

  // ç•«å¤šé‚Šå½¢ï¼ˆ0~100 â†’ 0~1ï¼‰
  const values = labels.map(k => (type8?.[k] ?? 0));
  const clamp01 = x => Math.max(0, Math.min(1, (x||0)/100));
  const angles = [-135,-90,-45,0,45,90,135,180].map(a=>a*Math.PI/180);

  const pts = [];
  for(let i=0;i<8;i++){
    const f = clamp01(values[i]);
    const a = angles[i];
    const dx = Math.cos(a), dy = Math.sin(a);
    const maxToSquare = half / Math.max(Math.abs(dx), Math.abs(dy));
    pts.push({ x: cX + maxToSquare * f * dx, y: cY + maxToSquare * f * dy });
  }

  ctx.beginPath();
  ctx.moveTo(pts[0].x, pts[0].y);
  for(let i=1;i<8;i++) ctx.lineTo(pts[i].x, pts[i].y);
  ctx.closePath();

  ctx.fillStyle = "rgba(37,99,235,0.08)";
  ctx.strokeStyle = "#2563eb";
  ctx.lineWidth = Math.max(2, S * 0.008);
  ctx.fill();
  ctx.stroke();
}

/* ========= çµæœé¡¯ç¤º ========= */
function showResult(){
  if(answers.some(v=>!v)){
    alert("é‚„æœ‰é¡Œç›®æ²’ä½œç­”å–”ï½");
    return;
  }

  const res = analyzeTalent(answers);
  const p = res.percentages;     // D/B/T/S %
  const type8 = res.type8;       // 8 è§’è‰²åˆ†æ•¸ï¼ˆå–®èƒ½é‡=æœ¬èº«%ï¼Œé›™èƒ½é‡=å¹³å‡ï¼‰
  const main = res.mainEnergy;   // ä¸»èƒ½é‡ï¼ˆå››å¤§æœ€é«˜ï¼‰
  const role = res.final_trait;  // è§’è‰²ï¼ˆå…«é¡æœ€é«˜ï¼‰

  $("quizPage").style.display="none";
  $("resultPage").style.display="flex";

  // â‘  ç¬¬ä¸€è¡Œï¼šèƒ½é‡åŒä¸€è¡Œ
  $("energyLine").innerHTML =
    `<span class="label">æˆ‘çš„å¤©è³¦èƒ½é‡</span>`+
    ` <span>ğŸ”Œ ç™¼é›»æ©Ÿ Dï¼š${p.D}%</span>`+
    ` <span>ğŸ”¥ ç«ç„° Bï¼š${p.B}%</span>`+
    ` <span>ğŸ¥ ç¯€å¥ Tï¼š${p.T}%</span>`+
    ` <span>ğŸ›  é‹¼éµ Sï¼š${p.S}%</span>`;

  // â‘¡ é›·é”åœ–ï¼ˆåƒ 8 é¡åˆ†æ•¸ï¼‰
  drawRadar(type8);

  // âœ… è§£æåœ–ï¼šåªé¡¯ç¤ºæœ€é«˜æ¯”ä¾‹ï¼ˆä¸¦åˆ—é¡¯ç¤ºå…©å¼µï¼‰
  const maxVal = Math.max(p.D, p.B, p.T, p.S);
  const topKeys = ["D","B","T","S"].filter(k => p[k] === maxVal).slice(0,2);
  const wrap = $("traitImgs");
  wrap.className = topKeys.length === 1 ? "one" : "two";
  wrap.innerHTML = topKeys.map(k => `<img src="${ENERGY_IMAGE[k] || ""}" alt="${k}">`).join("");

  // â‘¢ ä¸»èƒ½é‡/è§’è‰²å°æ®µ
  const mainName = main === "D" ? "ç™¼é›»æ©Ÿ" : main === "B" ? "ç«ç„°" : main === "T" ? "ç¯€å¥" : "é‹¼éµ";
 const roleScore = (type8?.[role] ?? 0);

$("summaryLine").textContent =
  `ä½ çš„ä¸»èƒ½é‡æ˜¯ã€${mainName}ã€‘\n`+
  `ä½ å¤©è³¦é †æµè§’è‰²æ˜¯ã€${role}ã€‘ã€‚`;


  // â‘£ è§’è‰²è§£æ
  const block = TRAIT_BLOCKS[role] || { title:`${role}`, oneLine:"", adv:"", blind:"", wealth:"" };
  $("finalTraitTitle").textContent = block.title || role;
  $("traitOneLine").textContent = block.oneLine || "";
  $("advText").textContent = block.adv || "";
  $("blindText").textContent = block.blind || "";
  $("wealthText").textContent = block.wealth || "";
}

/* ========= åˆå§‹åŒ– ========= */
window.addEventListener("DOMContentLoaded", ()=>{
  $("startBtn").addEventListener("click", startQuiz);
  $("prevBtn").addEventListener("click", prevQ);
  $("nextBtn").addEventListener("click", nextQ);
  $("againBtn").addEventListener("click", restartQuiz);
});
</script>
</body>
</html>

